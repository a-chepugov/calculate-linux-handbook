# Возможности Portage[¶](#Возможности-Portage)

* [Возможности Portage](#Возможности-Portage)
* [Возможности Portage](#Возможности-Portage)
* [Распределенная компиляция](#Распределенная-компиляция)
* [Использование distcc](#Использование-distcc)
* [Установка distcc](#Установка-distcc)
* [Подключение поддержки Portage](#Подключение-поддержки-Portage)
* [Кэширование компиляции](#Кэширование-компиляции)
* [О средстве ccache](#О-средстве-ccache)
* [Установка ccache](#Установка-ccache)
* [Подключение поддержки Portage](#Подключение-поддержки-Portage)
* [Использование ccache для компиляции Си не в Portage](#Использование-ccache-для-компиляции-Си-не-в-Portage)
* [Поддержка двоичных пакетов](#Поддержка-двоичных-пакетов)
* [Создание готовых (заранее собранных) пакетов](#Создание-готовых-заранее-собранных-пакетов)
* [Установка двоичных пакетов](#Установка-двоичных-пакетов)

## Возможности Portage[¶](#Возможности-Portage)

В Portage есть несколько дополнительных возможностей. Многие из этих возможностей полагаются на определенные программы, повышающие производительность, надежность, безопасность и т.п.

Для включения и выключения определенных возможностей Portage нужно редактировать в файле `/etc/make.conf` переменную FEATURES, в которой перечислены ключевые слова, разделенные пробелами, обозначающие различные возможности. Иногда для использования соответствующих возможностей потребуется установка дополнительных утилит.

Здесь перечислены не все возможности, поддерживаемые Portage. Полный перечень представлен на странице справки [/etc/make.conf](/etc/make.conf.html).

Чтобы узнать, какие возможности включены по умолчанию, запустите emerge --info и найдите переменную `FEATURES` (или отфильтруйте ее с помощью grep):

    emerge --info | grep FEATURES

## Распределенная компиляция[¶](#Распределенная-компиляция)

### Использование distcc[¶](#Использование-distcc)

distcc - программа, распределяющая компиляцию по нескольким, не обязательно одинаковым, машинам в сети. Клиент distcc посылает всю необходимую информацию на доступные серверы distcc (на которых выполняется distccd), чтобы они могли компилировать для клиента части исходного кода. Чистый выигрыш - более быстрая компиляция.

### Установка distcc[¶](#Установка-distcc)

Distcc поставляется с графическим монитором (средством контроля), позволяющим отслеживать задачи, которые ваш компьютер отсылает на компиляцию. Если вы используете Gnome, тогда добавьте "gnome" к переменной USE. А если вы не пользуетесь Gnome, но при этом хотите пользоваться монитором, добавьте "gtk" к переменной USE.

Установка distcc:

    emerge distcc

### Подключение поддержки Portage[¶](#Подключение-поддержки-Portage)

Добавьте distcc к переменной `FEATURES` в файле `/etc/make.conf`. Затем отредактируйте переменную `MAKEOPTS`, как вам нравится. Известная рекомендация - указывать директиву "-jX", где X - число центральных процессоров, на которых работает `distccd` (включая текущий компьютер) плюс один; у вас могут получиться лучшие результаты и с другими значениями.

Теперь запустите distcc-config и введите список доступных серверов distcc. Для простоты примера, предположим, что доступные серверы DistCC - 192.168.1.102 (текущий компьютер), 192.168.1.103 и 192.168.1.104 (два «удаленных» компьютера):

    distcc-config --set-hosts "192.168.1.102 192.168.1.103 192.168.1.104"

Не забудьте также запустить демон distccd:

    rc-update add distccd default  
    /etc/init.d/distccd start

## Кэширование компиляции[¶](#Кэширование-компиляции)

### О средстве ccache[¶](#О-средстве-ccache)

ccache - это быстрый кэш компилятора. Когда вы компилируете программу, он кэширует промежуточные результаты так, что всякий раз, когда вы перекомпилируете ту же самую программу, время компиляции значительно сокращается. В типичных случаях общее время компиляции может сокращаться в 5-10 раз.

Более подробно про ccache можно узнать на [сайте проекта](http://ccache.samba.org).

### Установка ccache[¶](#Установка-ccache)

Для установки ccache, выполните emerge ccache:

    emerge ccache

### Подключение поддержки Portage[¶](#Подключение-поддержки-Portage)

Откройте `/etc/make.conf` и добавьте ccache к переменной `FEATURES`. Затем добавьте новую переменную по имени `CCACHE_SIZE` (размер кэша), и установите её равной "2G":

    CCACHE_SIZE="2G"

Для проверки работоспособности ccache, запросите статистику ccache. 
    
    ccache -s

Из-за того, что Portage использует другой домашний каталог ccache, вам также потребуется установить переменную CCACHE\_DIR:

    CCACHE_DIR="/var/tmp/ccache"

Домашний каталог ccache по умолчанию - `/var/tmp/ccache`; изменить это назначение можно, определив переменную CCACHE\_DIR в `/etc/make.conf`.

Однако, при запуске ccache используется каталог по умолчанию, `${HOME}/.ccache`, вот почему при запросе статистики (Portage) ccache требуется определять переменную CCACHE\_DIR.

### Использование ccache для компиляции Си не в Portage[¶](#Использование-ccache-для-компиляции-Си-не-в-Portage)

Если вы хотите использовать `ccache` для компиляций не в Portage, добавьте `/usr/lib/ccache/bin` в начало вашей переменной PATH (перед `/usr/bin`). Это можно сделать, отредактировав `/etc/env.d/00basic`, который является первым файлом среды, где определяется переменная PATH:

    PATH="/usr/lib/ccache/bin:/opt/bin"

## Поддержка двоичных пакетов[¶](#Поддержка-двоичных-пакетов)

### Создание готовых (заранее собранных) пакетов[¶](#Создание-готовых-заранее-собранных-пакетов)

Portage поддерживает установку заранее собранных готовых пакетов. Несмотря на то, что для большинства дистрибутивов Calculate Linux есть поддержка заранее собранных пакетов, их количество ограничено составом пакетов дистрибутива. Вам также может понадобится подготовить пакеты с необходимыми вам [USE-флагами](USE-флагами.html).

Чтобы создать двоичный пакет, можно использовать quickpkg, если пакет уже установлен в вашей системе, или emerge с параметрами --buildpkg или --buildpkgonly.

Если вы хотите, чтобы Portage создавал двоичные пакеты из каждого пакета, который вы будете устанавливать, в `/etc/make.conf` добавьте buildpkg к переменной `FEATURES`.

### Установка двоичных пакетов[¶](#Установка-двоичных-пакетов)

Дистрибутивы [Calculate Linux Desktop](Calculate Linux Desktop.html) (KDE и XFCE) и [Calculate Directory Server](Calculate Directory Server.html) используют бинарное хранилище обновлений содержащее пакеты, входящие в образ дистрибутива. Каждый из перечисленных дистрибутивов имеет как обычный профиль, так и бинарный, используемый по умолчанию. В бинарном профиле доступна только одна стабильная версия для каждого двоичного пакета.

Обратите внимание, перед установкой двоичного пакета из хранилища нужно выполнить обновление оверлея `Calculate` layman -s calculate.

Помимо маскировки, профиль устанавливает переменной `FEATURES` значение getbinpkg, отдавая приоритет установке бинарных пакетов.

Путь к хранилищу указан в переменной `PORTAGE_BINHOST` в профиле дистрибутива. Для примера, в файле `/etc/make.conf` приведены пути к альтернативным хранилищам.

Вы можете устанавливать двоичные пакеты используя и обычный профиль. Для этого указывайте в команде emerge параметр -g (или --getbinpkg) вместе с параметром -k (или --usepkg). Первый указывает emerge загрузить двоичный пакет c сервера, определенного раньше, а второй сообщает emerge, что до загрузки исходных кодов и их компиляции сначала нужно попытаться установить этот двоичный пакет.

Например, чтобы установить gnumeric из двоичных пакетов:

    emerge -kg gnumeric

Подробную информацию о параметрах установки двоичных пакетов можно найти на странице [справки emerge](справки emerge.html).