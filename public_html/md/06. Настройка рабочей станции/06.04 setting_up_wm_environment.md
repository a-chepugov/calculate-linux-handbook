# Установка пользовательского окружения[¶](#Установка-пользовательского-окружения)

## Введение[¶](#Введение)

При установке системы на предприятии, либо при большом количестве пользователей, может встать вопрос об унификации интерфейса пользователя, добавлении необходимых настроек. Редактировать настройки каждого сеанса - достаточно трудоемкое и неблагодарное занятие. Здесь мы расскажем о возможностях пакета _calculate-client_ по настройке рабочего стола пользователя на примере KDE4\.

## Шаблоны настроек[¶](#Шаблоны-настроек)

Утилиты [Calculate](Calculate.html) в своей работе используют шаблоны. Это достаточно универсальный и мощный механизм для настройки программного обеспечения. При помощи шаблонов можно настроить систему, установить и настроить сервер или изменить внешний вид рабочего стола.

Ознакомьтесь с [подробным руководством](подробным руководством.html) по возможностям шаблонов. В этой статье мы покажем несколько примеров по возможностям настройки приложений пользователя.

## Размещение[¶](#Размещение)

При наличии [Calculate Directory Server](Calculate Directory Server.html), рабочий стол пользователя может быть настроен с учётом особенностей работы предприятия. При [вводе Linux ПК в домен](вводе Linux ПК в домен.html), при помощи утилиты _cl-client_, монтируется сетевой диск в директорию `/var/calculate/remote`. Это отличное место для размещения шаблонов настройки профилей пользователей.

Для начала посмотрите примеры шаблонов из состава пакета _calculate-client_ в директории _/var/lib/layman/calculate/profiles/templates/client_. Директории _domain_ и _undomain_ содержат шаблоны ввода рабочей станции в домен и вывода.

По умолчанию в утилитах _calculate-client 2.1.x_ может быть неограниченное количество директорий в шаблоне, разбивающих настройки на логические составляющие, обрабатываемые в алфавитном порядке. Внутри любой директории может быть служебный файл `.calculate_directory`, определяющий условия применения шаблонов этой директории. Если этого файла нет, шаблон будет применяться при каждом входе в систему. В случае если там будет ложное условие проверки, шаблон из директории применяться не будет.

Пример создания шаблона _MyFirm_ для клиентов [Calculate Linux Desktop](Calculate Linux Desktop.html):  

    
    mkdir -p /var/calculate/remote/templates/client/MyFirm
    

  
Если вы используете Calculate Linux Desktop XFCE, здесь и далее в примерах замените директорию шаблона с CLD на CLDX.

Создайте файл `.calculate_directory` в директории шаблона, если вы хотите добавить условия применения шаблона _MyFirm_. Например, добавить условие применения этого шаблона только при первом сеансе можно, добавив следующее содержимое в этот файл:  

    
    # Calculate cl_pass_step==first
    

Если вы используете Calculate Linux Desktop без домена, вы можете создать описанные директории локально либо на сетевом диске.

## Использование[¶](#Использование)

Утилиты из пакета [calculate-client](calculate-client.html) имеют богатые возможности по настройке рабочего стола [KDE4](http://www.kde.org). В зависимости от приложения, создается один или более файлов шаблона. Большинство настроек хранятся в директории `.kde4/share/config`. Файлы в этой директории имеют название схожее с именем приложения и заканчиваются на _rc_. Дополнительные настройки могут храниться в директории приложения, расположенной в `.kde4/share/apps`. Директория называется также по имени приложения, но без окончания _rc_.

Для создания шаблона, просто создайте в директории удаленного шаблона файл с тем же путем.

Обратите внимание, что интерпретатор должен правильно определить формат файла, поэтому в первой строке шаблона вы должны указать его формат. Для большинства конфигурационных файлов KDE4 это будет _kde_:  

    
    # Calculate format=kde
    

Прочитав формат _kde_, интерпретатор выполнит объединение файла шаблона с существующим файлом настроек. Таким образом, в шаблоне вам достаточно указать только необходимые изменения.

Обратите внимание: отсутствие заголовка в файле шаблона, в зависимости от содержимого, будет восприниматься как текстовый либо бинарный файл. Такой файл будет попросту переписывать текущий.

Следует также не забывать о том, что в формате _kde_ все переменные расположены в областях действия имен. Области имеют названия, записанные в квадратных скобках. В шаблонах обязательно следует указывать, в какой области находятся заменяемые переменные.

Попробуем разобраться на примерах.

## Примеры[¶](#Примеры)

### Стартовая страница браузера[¶](#Стартовая-страница-браузера)

В шаблоне _MyFirm_ отредактируем настройки браузера _Konqueror_, изменив адрес домашней страницы пользователя.

Создадим путь к файлу в шаблоне:  

    
    mkdir -p /var/calculate/remote/templates/client/MyFirm/.kde4/share/config/
    

  
в котором создадим файл `konquerorrc` со следующим содержимым:  

    
    # Calculate format=kde
    [UserSettings]
    #Домашняя страница
    HomeURL=http://www.google.com
    

Первая строка служебная, в ней мы описываем формат конфигурационного файла. По умолчанию созданный нами шаблон объединяется с существующим, меняя значения переменных. Таким образом, после захода в сеанс пользователь всегда в качестве домашней страницы будет попадать на страницу поисковика Google, как бы он настройки ни менял.

Но вот страница, которая отображается в браузере первой, будет оставаться той же, так как она настраивается в другом месте. Для ее изменения создадим следующий путь:  

    
    mkdir -p /var/calculate/remote/templates/client/MyFirm/.kde4/share/apps/konqueror/profiles
    

  
в котором создадим файл `webbrowsing` со следующим содержимым:  

    
    # Calculate format=kde
    [Profile]
    #просмотр домашней страницы при старте Konqueror
    View0_URL=http://www.google.com
    

Теперь при запуске браузера пользователь будет видеть страницу Google. При нажатии на кнопочку домашней страницы в браузере также будет отображаться страница Google.

Обратите внимание, что в обоих примерах указываются области действия переменных \[UserSettings\] и \[Profile\]. Важно правильно указать их, разместив переменные после их объявления; этого требует синтаксис конфигурационного файла.

### Прокси сервер[¶](#Прокси-сервер)

Приведем еще один пример. Допустим, вам нужно изменить прокси сервер. Создайте следующий путь:  

    
    mkdir -p /var/calculate/remote/templates/client/MyFirm/single/.kde4/share/config
    

  
в который поместите файл `kioslaverc` со следующим содержимым:  

    
    # Calculate format=kde
    [Proxy Settings]
    AuthMode=0
    NoProxyFor=
    Proxy Config Script=
    ProxyType=1
    ReversedException=false
    ftpProxy=http://proxy.mydomain.ru:8080
    httpProxy=http://proxy.mydomain.ru:8080
    httpsProxy=http://proxy.mydomain.ru:8080