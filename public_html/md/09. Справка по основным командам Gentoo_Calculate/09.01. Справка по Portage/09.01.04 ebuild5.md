# EBUILD (5)[¶](#EBUILD-5)

## НАЗВАНИЕ[¶](#НАЗВАНИЕ)

ebuild - внутренний формат, переменные и функции в сценарии ebuild

## ОПИСАНИЕ[¶](#ОПИСАНИЕ)

Программа **[ebuild](ebuild.html)** (1) может принять в качестве аргумента только один сценарий ebuild. Сценарий ebuild содержит переменные и команды, которые определяют, каким образом следует загружать исходный код того или иного программного пакета, распаковывать его, накладывать патчи, компилировать, устанавливать и включать в дерево. Кроме того, в сценарий также входят команды, которые должны выполняться до и после установки/удаления пакетов. Все сценарии ebuild написаны на bash.

### Атомы зависимости[¶](#Атомы-зависимости)

_Атомы зависимости_ представляют собой не что иное как зависимости, к которым будет обращаться portage, выявляя отношения между пакетами. Обратите внимание, что если атом еще не в дереве пакетов, значение переменной совпадает с последней доступной версией.

**Базовые** **атомы**

Базовый атом - это полное имя пакета: категория/пакет.

Вот примеры базовых атомов:   

    
        sys-apps/sed 
        sys-libs/zlib 
        net-misc/dhcp 
    

**Версии атомов**

Иногда необходимо уточнение, что подойдут лишь определенные версии атомов. Обратите внимание, что в этом случае их нужно указывать с префиксом (см. ниже). Иными словами, номер версии просто добавляется как суффикс к базовому атому.

Примеры:   

    
        sys-apps/sed-4.0.5 
        sys-libs/zlib-1.1.4-r1 
        net-misc/dhcp-3.0_p2 
    

Номера версий обычно состоят из двух или трех чисел, разделенных точками, например, 1.2 или 4.5.2\. После этой строки может идти буква - например, возможны такие номера версий как 1.2a или 4.5.2z. Имейте в виду, что эта буква _не обозначает_ альфа- или бета-версию. Для этого используется специальный необязательный суффикс: \_alpha, \_beta, \_pre (предрелиз), \_rc (кандидат в релизы) или \_p (патч). Таким образом, третий предрелиз пакета будет обозначен, например, как 1.2\_pre3\. Суффиксы можно добавлять один за другим в неограниченном количестве.

**Префиксные операторы атома \[\> \>= = **

Иногда необходимо задать зависимость от группы версий, не указывая явно каждую из них. Для этого удобно использовать стандартные булевы операторы.

Примеры:   

    
        >media-libs/libgd-1.6 
        >=media-libs/libgd-1.6 
        =media-libs/libgd-1.6 
        <=media-libs/libgd-1.6 
        <media-libs/libgd-1.6 
    

**Расширенные префиксы \[!~\]и суффиксы атома \[\*\]**

Для большей точности возможно указывать блокирующие пакеты и соответствующие им диапазоны версий. Обратите внимание, что эти дополнительные префиксы/суффиксы можно сочетать любым способом с классами атомов, о которых шла речь выше.

_~_

означает любую ревизию указанной базовой версии. Так, в приведенном выше примере в выборке окажутся версии '1.0.2a', '1.0.2a-r1', '1.0.2a-r2' и т.д.

Пример:   

    
        ~net-libs/libnet-1.0.2a 
    

_!_

предотвращает одновременную установку пакетов, блокирующих друг друга.

Пример:   

    
        !app-text/dos2unix 
    

_!!_

предотвращает одновременную установку пакетов и при этом явно запрещает их одновременную временную установку в серии обновлений. Данный синтаксис поддерживается в **EAPI 2** и выше.

Пример:   

    
        !!<sys-apps/portage-2.1.4_rc1 
    

_\*_

означает любую версию пакета при условии совпадения указанного префикса строки. Таким образом, если в качестве версии указано '2\*', будут учитываться версии '2.1', '2.2', '2.2.1' и т.п., но не '1.0', '3.0', '4.1' и т.д. Не забудьте: в силу того, что вы используете подстановочный знак, шаблону '2\*' будет соответствовать и '20'. Часть версии перед '\*' должна быть корректным номером версии, без '\*'.. Например, '2' - корректный номер версии, а '2.' - нет. Иными словами, вы можете использовать обозначение '2\*', но не '2.\*'.

Примеры:   

    
        =dev-libs/glib-2* 
        !=net-fs/samba-2* 
    

**Слоты атомов**

Начиная с **EAPI 1** может быть задан **слот** любого атома. Для этого необходимо указать имя **слота**, через двоеточие.

Например:   

    
        x11-libs/qt:3 
        ~x11-libs/qt-3.3.8:3 
        >=x11-libs/qt-3.3.8:3 
        =x11-libs/qt-3.3*:3 
    

**Подслоты**

Начиная с **EAPI 5** зависимость слота может содержать опциональный подслот, который указывается через слэш _/_.

Примеры:   

    
        dev-libs/icu:0/0 
        dev-libs/icu:0/49 
        dev-lang/perl:0/5.12 
        dev-libs/glib:2/2.30 
    

**Операторы атомов слотов**

Начиная с **EAPI 5**, оператором слота выступает двоеточие, за которым следует один из следующих операторов:

_\*_

Означает, что разрешается любое значение слота. Кроме того, для сборочных зависимостей обозначает, что пакет, совпадающий с запросом, может быть удалён и заменён другим совпадающим в другом слоте.

Примеры:   

    
        dev-libs/icu:* 
        dev-lang/perl:* 
        dev-libs/glib:* 
    

_=_

Означает,что допускается любое значение слота. Кроме того, для сборочных зависимостей означает, что слот и подслот пакета, совпадающего с запросом, обязательно должны совпадать со слотом и подслотом последней присутствующей в системе на момент установки версии.

Примеры:   

    
        dev-libs/icu:= 
        dev-lang/perl:= 
        dev-libs/glib:= 
    

_slot=_

Означает то же, что и оператор равенства, за исключением того, что для слота допускается лишь одно определённое значение.

Примеры:   

    
        dev-libs/icu:0= 
        dev-lang/perl:0= 
        dev-libs/glib:2= 
    

Чтобы использовать оператор равенства слота, пакетный менеджер должен сохранить пару слот/подслот новейшей установленной версии пакета. Описанный синтаксис обрабатывается только пакетным менеджером и не предназначен для ебилдов. Для этого пакетный менеджер при сохранении зависимостей пакета может вставлять соответствующий слот/подслот между двоеточием и знаком равенства. Обозначение подслота в этом случае опускать нельзя (когда это делает переменная SLOT, подразумевается, что пакет имеет подслот, совпадающий со слотом).

Примеры:   

    
        dev-libs/icu:0/0= 
        dev-libs/icu:0/49= 
        dev-lang/perl:0/5.12= 
        dev-libs/glib:2/2.30= 
    

**USE-флаги атомов**

Начиная с **EAPI 2** для любого атома могут быть заданы **USE** -флаги. Если при этом вы также указываете **слоты**, то зависимости **USE** -флагов будут выводится справа от зависимостей **слотов**.

**Безусловные USE-зависимости**
Пример
Расшифровка

foo\[bar\]
foo требует, чтобы был включен bar

foo\[bar,baz\]
foo требует, чтобы были включены и bar, и baz

foo\[-bar,baz\]
foo требует, чтобы bar был отключен, а baz включен

**Условные USE-зависимости**
Краткая запись
Развернутая запись

foo\[bar?\]
bar? ( foo\[bar\] ) !bar? ( foo )

foo\[!bar?\]
bar? ( foo ) !bar? ( foo\[-bar\] )

foo\[bar=\]
bar? ( foo\[bar\] ) !bar? ( foo\[-bar\] )

foo\[!bar=\]
bar? ( foo\[-bar\] ) !bar? ( foo\[bar\] )

**USE-флаги атомов по умолчанию**

Начиная с **EAPI 4** **USE-** зависимости умеют устанавливать значения по умолчанию для флагов, которые могут быть не прописаны в **IUSE** для данного пакета. Для этого непосредственно вслед за флагом поставьте соответственно **(+)** или **(-)**: **(+)** указывает системе вести себя так, словно отсутствующий флаг присутствует и включен, **(-)** - так, словно отсутствующий флаг присутствует, но отключен.

    
    media-video/ffmpeg[threads(+)] 
    media-video/ffmpeg[threads(-)] 
    

**Динамические зависимости**

Зачастую программы могут иметь различные зависимости при различных USE-флагах. Система портежей предлагает несколько опций для учета этого. Заметьте, что каждая синтаксическая конструкция из числа описанных ниже каждая конструкция рассматривается как один атом в соответствующем контексте. Таким образом, каждый атом за счет задания условий может включать несколько атомов, и эта вложенность может быть любой глубины.

**переменная\_use? ( атом )**

Так, чтобы включить библиотеку jpeg, при указании пользователем jpeg в переменной **USE**, используйте следующую конструкцию:

jpeg? ( media-libs/jpeg )

**!переменная\_use? ( атом )**

Если пакет необходимо включать только при отсутствии определенной опции в пользовательском значении переменной USE, используйте конструкцию, подобную:

!nophysfs? ( dev-games/physfs )

Это удобно в том случае, если вы хотите добавить необязательную поддержку той или иной возможности и установливать ее по умолчанию.

**переменная\_use? ( атом, если истинно ) !переменная\_use? ( атом, если ложно )**

Для обработки аналогично тернарному оператору языка C используйте два утверждения, одно прямое, другое обратное. Так, если пакет использует GTK2 или GTK1, но не оба вместе, это можно выразить следующим образом:

gtk2? ( =x11-libs/gtk+-2\* ) !gtk2? ( =x11-libs/gtk+-1\* )

В результате по умолчанию будет использоваться более новая библиотека, GTK2\.

**|| ( Atom Atom ... )**

Если пакет может работать с несколькими различными пакетами, но категория virtual не подходит, может быть использован следующий синтаксис:

    
    || ( 
        app-games/unreal-tournament 
        app-games/unreal-tournament-goty 
    ) 
    

В приведенном примере мы видим, что пакет unreal-tournament существует в обычной версии и в версии goty. Поскольку обе они предоставляют один и тот же базовый набор файлов, другой пакет может использовать любой из них. Добавление категории virtual не подходит, поскольку она не охватывает соответствующие файлы.

Другой уместный случай использования данной конструкции - это когда пакет может быть собран с различными видео-интерфейсами, но не может использовать их одновременно.

Например:   

    
    || ( 
        sdl? ( media-libs/libsdl ) 
        svga? ( media-libs/svgalib ) 
        opengl? ( virtual/opengl ) 
        ggi? ( media-libs/libggi ) 
        virtual/x11 
    ) 
    

В данном случае будет выбран только один из пакетов, а приоритет определяется порядком их перечисления. Поэтому наиболее вероятным кандидатом является библиотека sdl, далее идут svga, opengl, ggi - и, наконец, по умолчанию, если пользователь не задал явно одну из предлагаемых библиотек, будет использоваться X.

Имейте в виду, что, если один из перечисленных пакетов уже установлен, менеджер пакетов будет руководствоваться этим для удовлетворения зависимости.

### Перекрёстная компиляция[¶](#-Перекрёстная-компиляция)

Portage поддерживает перекрёстную компиляцию в каталоге, определяемом переменной **ROOT**.

**Хост**

В данном случае под _хостом_ понимается платформа, на которой разворачивается процесс сборки - в системе сборки GNU это значение переменной CBUILD. Пакеты хоста хранятся в корневом каталоге системы ("_/_").

Если **ROOT** - "_/_", сюда будут устанавливаться все типы зависимостей. Если это не так, для EAPI, поддерживающих переменную **HDEPEND** (экспериментальный **EAPI 5-hdepend**), в каталог "_/_" будут устанавливаться только пакеты **HDEPEND**. Для EAPI без поддержки **HDEPEND** это поведение управляется опцией t _--root-deps_ команды **emerge**(1); по умолчанию в \_хост\_ будут устанавливаться только пакеты **DEPEND**.

**Цель**

Под _целью_ подразумевается платформа, на которой пакет в дальнейшем будет работать - в системе сборки GNU это значение переменной CHOST. Каталог, где располагается данная система, определяется переменной **ROOT**. Если этот каталог - не "_/_", то есть если _хост_ и _цель_ не совпадают, то путь, который хранится в переменной, указывает на каталог, в котором находится _цель_.

Для EAPI с поддержкой **HDEPEND** (экспериментальный **EAPI 5-hdepend**), переменные **DEPEND**, **RDEPEND** и **PDEPEND** содержат списки зависимостей _цели_ - иными словами, перечни пакетов, которые должны быть установлены в каталог **ROOT**. Для EAPI, которые не поддерживают **HDEPEND**, за установку в этот каталог отвечает опция _--root-deps_ пакетного менеджера **emerge**(1). Если данная опция не включена, **emerge** по умолчанию будет устанавливать сборочные зависимости (то есть пакеты **RDEPEND** и **PDEPEND**) только в каталог **ROOT**.

Подробнее о переменных **DEPEND**, **RDEPEND** и **HDEPEND** см. в разделе **ПЕРЕМЕННЫЕ**.

**USE-флаг targetroot**

Для EAPI, которые поддерживают USE-флаг "_targetroot_", пакетный менеджер автоматически включает данный флаг, если _host_ и _target_ не совпадают - иными словами, если значение **ROOT** - не "_/_". Это необходимо в том случае, если пакету в процессе сборки требуется исполняемая копия себя самого. Распространённым примером такой ситуации может служить пакет dev-lang/python, который при компиляции требует запуска интерпретатора Python.

## ПЕРЕМЕННЫЕ[¶](#ПЕРЕМЕННЫЕ)

**Замечания по синтаксису**

- В сценариях ebuild можно использовать все переменные, определенные в **[make.conf](.html)**(5) (такие как **PORTAGE** и **PORTDIR**)   
- Присваивая значения переменным в сценарии, **нельзя оставлять пробел** между именем переменной и знаком равенства.   
- Значения переменных могут содержать только символы из таблицы **ascii**(7). Это требование **GLEP 31**.

**P**

Эта переменная содержит имя пакета без указания ревизии сценария. Ее НЕЛЬЗЯ изменять.

xfree-4.2.1-r2.ebuild --\> $P=='xfree-4.2.1'

**PN**

Содержит имя сценария без номера версии.

xfree-4.2.1-r2.ebuild --\> $PN=='xfree'

**PV**

Содержит номер версии без указания ревизии.

xfree-4.2.1-r2.ebuild --\> $PV=='4.2.1'

**PR**

Содержит номер ревизии или, если его не существует, 'r0'.

xfree-4.2.1-r2.ebuild --\> $PR=='r2'

**PVR**

Содержит номер версии с указанием ревизии.

xfree-4.2.1-r2.ebuild --\> $PVR=='4.2.1-r2'

**PF**

Содержит полное имя пакета **PN**-**PVR**

xfree-4.2.1-r2.ebuild --\> $PF=='xfree-4.2.1-r2'

**КАТЕГОРИЯ**

Содержит имя категории пакета.

**A**

CСодержит все исходные файлы, необходимые пакету. Эта переменная не должна определяться: она генерируется автоматически на основе переменной **SRC\_URI**.

**WORKDIR** = _${PORTAGE\_TMPDIR}/portage/${CATEGORY}/${PF}/work_

Содержит путь доступа к корневому каталогу сборки пакета. Не изменяйте эту переменную.

**FILESDIR** = _${PORTDIR}/${CATEGORY}/${PN}/files_

Содержит путь доступа к подкаталогу 'files' в каталоге пакета в дереве портежей. Не изменяйте эту переменную.

**EBUILD\_PHASE**

Contains the abreviated name of the phase function that is currently executing, such as "setup", "unpack", "compile", or "preinst".

**EBUILD\_PHASE\_FUNC**

Начиная с **EAPI 5** содержит полное имя выполняемой в данный момент фазовой функции, например, "pkg\_setup", "src\_unpack", "src\_compile", "pkg\_preinst".

**EPREFIX**

Начиная с **EAPI 3** для этой переменной определено смещение, для которого был конфигурирован данный portage в ходе установки. Смещение иногда необходимо в ебилдах и еклассах; в этом случае оно определяется как ${EPREFIX}. EPREFIX не содержит слэша, поэтому отсутствию смещения соответствует пустая строка. Не изменяйте эту переменную.

**S** = _${WORKDIR}/${P}_

Содержит путь доступа к временному _каталогу сборки_. Эта переменная используется функциями _src\_compile_ и _src\_install_. Обе они выполняются в каталоге _S_. Данная переменная может быть изменена, если необходимо указать другой каталог для распаковки архива пакета.

**T** = _${PORTAGE\_TMPDIR}/portage/${CATEGORY}/${PF}/temp_

Содержит путь доступа к _временному каталогу_. Может использоваться в любых целях.

**D** = _${PORTAGE\_TMPDIR}/portage/${CATEGORY}/${PF}/image/_

Содержит путь доступа к временному _каталогу для установки_. Каждая операция записи, выполняемая не через вспомогательные утилиты и функции (они описаны ниже), должна выполняться в каталоге ${D}. Начиная с **EAPI 3** здесь, как правило, приходится учитывать префикс смещения, для которого отведена переменная ${ED} (см.ниже). Не изменяйте эту переменную.

**ED** = _${PORTAGE\_TMPDIR}/portage/${CATEGORY}/${PF}/image/${EPREFIX}/_

Начиная с **EAPI 3** для удобства содержит путь "${D%/}${EPREFIX}/". Для версий **EAPI** ниже **EAPI 3**, не поддерживающих **${ED}**, в тех случаях, когда в новых версиях используется **${ED}**, вспомогательные функции обращаются к **${D}**. Не изменяйте эту переменную.

**MERGE\_TYPE**

Начиная с **EAPI 4** переменная MERGE\_TYPE может использоваться для запроса текущего типа установки. Для нее запустимы следующие значения:
Значение
Расшифровка

binary
прекомпилированный пакет назначен для установки

buildonly
пакет будет скомпилирован из исходного кода, но не назначен для установки

source
пакет будет скомпилирован из исходного кода и назначен для установки

**PORTAGE\_LOG\_FILE**

Содержит путь доступа к журналу сборки. Если значение переменной **PORT\_LOGDIR** не назначено, то **PORTAGE\_LOG\_FILE**=**"${T}/build.log"**.

**REPLACED\_BY\_VERSION**

Начиная с **EAPI 4** переменная REPLACED\_BY\_VERSION может использоваться функциями pkg\_prerm и pkg\_postrm для запроса версии пакета, которая заменит текущую. Переменная пуста, если нет нового пакета; если же такой пакет имеется, переменная будет содержать только номер версии.

**REPLACING\_VERSIONS**

Начиная с **EAPI 4** переменная REPLACING\_VERSIONS может использоваться pkg\_pretend, pkg\_setup, pkg\_preinst и pkg\_postinst для запроса версии (версий) пакета, которую (которые) заменит данный пакет. Переменная пуста, если нет пакетов, которые подлежат замене; если есть хотя бы один такой пакет, переменная содержит, через пробел, номера версии (версий) пакета, которые будет/-ут заменена/-ы. Как правило, эта переменная не содержит более одной версии, хотя, согласно PMS, может содержать несколько их.

**ROOT** = _/_

Содержит путь, по которому portage обращается к корневому каталогу текущей файловой системы. Когда пакеты вносят изменения в эту файловую систему, они должны использовать для этого дерево с префиксом ${ROOT}. Часто при этом необходимо учитывать префикс смещения, за который отвечает переменная ${EROOT} (см. ниже). Не изменяйте эту переменную.

**EROOT** = _${ROOT%/}${EPREFIX}/_

Начиная с **EAPI 3** для удобства содержит "${ROOT%/}${EPREFIX}/". Не изменяйте эту переменную.

**DESCRIPTION** = _A happy little package_

Содержит краткое описание пакета.

**EAPI** = _0_

Определяет версию API ебилда, которой соответствует данный пакет. Если значение не определено, то по умолчанию выставляется "0". Если portage не распознал значение EAPI, пакет будет замаскирован и какие-либо операции над ним будут невозможны; в этом случае сначала необходимо обновить portage. Для максимальной обратной совместимости пакет должен соответствовать как можно более ранней версии EAPI. Обратите внимание, что использование команд **[ebuild](ebuild.html)**(1) и **[repoman](.html)**(1) с пакетом требует версии portage, которая умеет работать с соответствующей данному пакету версией EAPI.

**SRC\_URI** = _http://example.com/path/${P}.tar.gz_

Содержит перечень URI необходимых файлов исходного кода. Одному файлу при этом могут соответствовать несколько URI. Список обрабатывается в порядке следования элементов: если элемент не удается найти ни на одном из зеркал \_GENTOO\_MIRRORS, система переходит к следующему элементу. Начиная с **EAPI 2** имя файла вывода определенного URI может быть изменено по вашему желанию: для этого справа ставится оператор "-\>" и, вслед за ним, имя файла вывода, какое вы предпочитаете. Все элементы, в частности, оператор и имя файла вывода, разделяются пробелом.

**HOMEPAGE** = _http://example.com/_

Эта переменная должна содержать URI основных сайтов, с которых берутся исходные коды, и другую дополнительную информацию, в зависимости от пакета.

**KEYWORDS** = _\[-~\]\[x86,ppc,sparc,mips,alpha,arm,hppa\]_

Эта переменная должна содержать корректный список архитектур, под которыми работает/не работает ебилд. По умолчанию, если неизвестно, требует ли ебилд определенной архитектуры, соответствующее значение KEYWORD просто не указывается. Если известно, что ебилд не работает под той или иной архитектурой, укажите ее с минусом, например, -ppc. Если ебилд посылается для включения в дерево, он должен иметь ключ ~arch для архитектур, на которых он ПРЕДПОЛОЖИТЕЛЬНО РАБОТАЕТ. (Чтобы размаскировать для тестирования пакеты, помеченные такими ключевыми словами, укажите ACCEPT\_KEYWORDS="~arch" в командной строке или непосредственно в файле **[make.conf](.html)**(5)) Полный список архитектур см. в /usr/portage/profiles/arch.list. Старайтесь соблюдать алфавитный порядок списка.

**SLOT**

Устанавливает слот для пакетов, для работы которых может понадобиться сосуществование несколько версий. Значение по умолчанию - **SLOT**="0". Если вы не вполне уверены в своих действиях, не пытайтесь экспериментировать с этой переменной. В любом случае, ее значение _НИКОГДА_ не должно оставаться неопределенным.

Начиная с **EAPI 5** переменная SLOT может опционально содержать подслот; он указывается вслед за слотом, от которого отделяется слэшем /. Подслот должен представлять собой корректное имя слота. Подслоты используются в тех случаях, когда обновление пакета до новой версии с другим подслотом может потребовать пересборки пакетов-зависимостей. Если подслот в переменной SLOT не определён, подразумевается, что пакет имеет подслот, совпадающий с основным слотом. Подробнее об использовании подслотов см. в разделе **Операторы атомов слотов**.

**LICENSE**

Представляет собой перечень, через пробел, лицензий, под которые подпадает пакет. Этот список **должен** соответствовать содержимому /usr/portage/licenses/. Если той или иной лицензии нет в portage, следует добавить ее явно.

**IUSE**

Представляет собой практически исчерпывающий список USE-флагов, которые используются в вашем сценарии ebuild. Здесь не фигурируют только те USE-флаги, которые описывают архитектуру (см. **KEYWORDS**). Начиная с **EAPI 1** можно создавать настройки по умолчанию, включая или отключая **USE** -флаги путем выставления перед именами флагов соответственно + и - . Более подробно о порядке помещения в стек **USE** -флагов см. в разделе, посвященном переменной **USE\_ORDER** в **[make.conf](.html)**(5). С учетом значения по умолчанию **USE\_ORDER**, отрицательные настройки IUSE по умолчанию действуют на USE только на уровне репозитория, поскольку параметры профиля и пользовательские настройки имеют над ними приоритет.

**DEPEND**

Данная переменная должна содержать перечень пакетов, необходимых программе для компиляции (они же сборочные зависимости). Как правило, это библиотеки и заголовки.

Начиная с экспериментального **EAPI 5-hdepend** список утилит следует хранить не здесь, а в переменной **HDEPEND**, поскольку пакеты **DEPEND** будут установлены в каталог _цели_, а значит, не смогут выполняться при перекрёстной компиляции (подробнее см. в разделе **Перекрёстная компиляция**).

Здесь вы можете использовать синтаксис, описанный в разделе **Зависимости**.

**RDEPEND**

Эта переменная должна содержать перечень всех пакетов, необходимых для работы данной программы (они же сборочные зависимости). Как правило, это библиотеки.

**EAPI** 3 и ниже, если она не определена, по умолчанию будет использовано значение переменной **DEPEND**. В **EAPI** 4 и выше переменная **RDEPEND** никогда не задается явно.

Здесь вы можете использовать синтаксис, аналогичный описанному выше в разделе **Зависимости**.

**HDEPEND**

Эта переменная должна содержать перечень всех пакетов, которые должны быть доступны как исполняемые при сборке данной программы (они же сборочные зависимости). Как правило, это утилиты: интерпретаторы или (кросс-)компиляторы.

Эта переменная была введена в экспериментальном **EAPI 5-hdepend** и будет установлена в каталог _хоста_ (подробнее см. в разделе **Перекрёстная компиляция**).

Здесь вы можете использовать синтаксис, аналогичный описанному выше в разделе **Зависимости**.

**PDEPEND**

Эта переменная должна содержать перечень всех пакетов, которые следует установить после установки данного пакета (постсборочные зависимости), но фактически они могут быть установлены раньше.

**\*\*\*ВНИМАНИЕ\*\*\***   
Используйте эту возможность только в крайнем случае для прерывания циклических зависимостей!

Здесь вы можете использовать синтаксис, аналогичный описанному выше в разделе **Зависимости**.

**REQUIRED\_USE**

Начиная с **EAPI 4** используется переменная **REQUIRED\_USE**, позволяющая указывать допустимые и недопустимые комбинации **USE-** флагов. При необходимости можно использовать вложения.
Действие
Выражение

Если флаг1 включен, то флаг2 отключен
флаг1? ( !флаг2 )

Если флаг1 включен, то флаг2 включен
флаг1? ( флаг2 )

Если флаг1 отключен, то флаг2 включен
!флаг1? ( флаг2 )

Если флаг1 отключен, то флаг2 отключен
!флаг1? ( !флаг2 )

Следует включить любой из флагов (включающее ИЛИ)
|| ( флаг1 флаг2 флаг3 )

Следует включить только один определенный флаг (исключающее ИЛИ)
^^ ( флаг1 флаг2 флаг3 )

(Начиная с EAPI 5:) Можно включить в крайнем случае один определённый флаг
?? ( флаг1 флаг2 флаг3 )

**RESTRICT** = _\[strip,mirror,fetch,userpriv\]_

Задает ограничения возможностей системы портежей, через пробел. Для задания динамических ограничений можно использовать условные конструкции, аналогичные описанным выше для переменной **DEPEND**.

_binchecks_

Отключает проверку бинарных файлов. Используйте это значение ТОЛЬКО в том случае, если такая проверка не имеет смысла (например, для оригинальных заголовков и исходных кодов ядра, которые не имеют бинарных версий). Если опрос бинарных файлов следует пропустить по другим причинам (например, если речь идет о проприетарных бинарных компонентах), см. подробнее в разделе **УПРАВЛЯЮЩИЕ QA-ПЕРЕМЕННЫЕ**.

_bindist_

Ограничение по собранным пакетам.

_fetch_

Аналогично _mirror_, но файлы не будут выбираться и через переменную **SRC\_URI**.

_installsources_

Отключает installsources для определенных пакетов. Предназначено для пакетов, имеющих бинарные файлы, которые не совместимы с debugedit.

_mirror_

Файлы, указанные в переменной **SRC\_URI**, не будут загружаться с зеркал **GENTOO\_MIRRORS**

_primaryuri_

Файлы будут загружаться сначала с URI, указанных в переменной **SRC\_URI**, и лишь потом с зеркал **GENTOO\_MIRRORS**.

_strip_

Из результирующих двоичных модулей/библиотек не будет удаляться отладочная информация.

_test_

src\_test не будет запускаться, даже если пользовательское значение **FEATURES**=test.

_userpriv_

Отключает userpriv для определенных пакетов.

**PROPERTIES** = _\[interactive\]_

Список параметров через пробел; поддерживается синтаксис условных конструкций.

_interactive_

На одной или нескольких фазах ебилда пользователю будет предложено ввести данные.

**PROVIDE** = _"virtual/ЦЕЛЬ"_

Эту переменную следует использовать, только если пакет имеет виртуальную цель. Например, blackdown-jdk и sun-jdk предоставляют virtual/jdk. Это позволяет пакетам задавать зависимости от virtual/jdk, а не явно от реализации blackdown или sun.

**DOCS**

Начиная с **EAPI 4** эта переменная содержит массив или разделенный пробелами список документационных файлов для функции src\_install по умолчанию для установки с помощью dodoc. Если она не определена, будет использован разумный список по умолчанию. См. ниже справку по src\_install.

## УПРАВЛЯЮЩИЕ QA-ПЕРЕМЕННЫЕ[¶](#УПРАВЛЯЮЩИЕ-QA-ПЕРЕМЕННЫЕ)

**Замечания по синтаксису**

Существует ряд QA-переменных, которые позволяют сценарию управлять некоторыми QA-тестами, выполняемыми portage. В ебилдах к ним следует прибегать как можно реже, поскольку в противном случае теряет смысл сам контроль качества. QA-переменные предназначены прежде всего для сценариев, которые устанавливают бинарные объекты из закрытых исходных кодов, которые не могут быть изменены.

Обратите внимание, что объекты, которые не соответствуют данным правилам, могут выдавать ошибку на некоторых архитектурах.

**QA\_PREBUILT**

Содержит перечень путей доступа к прекомпилированным, бинарным файлам в каталоге образа. Указанные здесь пути добавляются к каждой из перечисленных ниже переменных QA\_**. Пути могут включать fnmatch-подобные шаблоны, которые встроенными средствами переводятся в регулярные выражения для переменных QA\_**: последние не поддерживают такие шаблоны, а регулярные выражения - поддерживают. Переводчик просто заменяет "\*" на ".\*".

**QA\_TEXTRELS**

Может содержать перечень путей доступа к файлам в каталоге образа, которые содержат неустранимые text relocation. Пути могут включать шаблоны fnmatch.

Эта переменная предназначена для использования с бинарными объектами, установленными из закрытых исходных кодов, которые не могут быть изменены.

**QA\_EXECSTACK**

Содержит список путей доступа к объектам в каталоге образа, которые для запуска требуют исполняемый стек. Пути могут включать шаблоны fnmatch.

Эта переменная предназначена для использования с объектами, которым действительно нужен исполняемый стек (а не с теми, которые лишь маркированы соответствующим образом).

**QA\_WX\_LOAD**

Эта переменная должна содержать список путей доступа к файлам в каталоге образа, которые содержат перезаписываемые и исполняемые сегменты - что случается редко. Пути могут содержать шаблоны fnmatch.

**QA\_FLAGS\_IGNORED**

Эта переменная должна содержать список путей доступа к файлам в каталоге образа, которые не содержат .GCC.command.line-секции или содержат .hash-секции. Пути могут содержать регулярные выражения с экранированными символами, заключенными в управляющие кавычки.

Переменная предназначена для использования с файлами бинарных пакетов, которые игнорируют переменные CFLAGS, CXXFLAGS, FFLAGS, FCFLAGS, LDFLAGS.

**QA\_MULTILIB\_PATHS**

Эта переменная содержит список путей доступа к файлам в каталоге образа, которые должны быть проигнорированы при проверках multilib-strict. Пути могут содержать регулярные выражения с экранированными символами, заключенными в управляющие кавычки.

**QA\_PRESTRIPPED**

Эта переменная должна содержать список путей доступа к бинарным файлам в каталоге образа, не содержащим отладочной информации. Пути могут включать регулярные выражения с экранированными символами, заключенными в управляющие кавычки.

**QA\_SONAME**

Эта переменная должна содержать список путей доступа к файлам общедоступных библиотек в каталоге образа, не имеющих SONAME. Пути могут включать регулярные выражения с экранированными символами, заключенными в управляющие кавычки.

**QA\_SONAME\_NO\_SYMLINK**

Эта переменная должна содержать список путей доступа к файлам общедоступных библиотек в каталоге образа, имеющим SONAME, но символической ссылки на SONAME в том же каталоге быть не должно. Пути могут включать регулярные выражения с экранированными символами, заключенными в управляющие кавычки.

**QA\_DT\_NEEDED**

Эта переменная должна содержать список путей доступа к файлам общедоступных библиотек в каталоге образа, не имеющим записей NEEDED. Пути могут включать регулярные выражения с экранированными символами, заключенными в управляющие кавычки.

**QA\_DESKTOP\_FILE**

Эта переменная должна содержать список путей доступа к desktop-файлам в каталоге образа, которые не должны учитываться. Пути могут включать регулярные выражения с экранированными символами, заключенными в управляющие кавычки.

## ОБЪЯВЛЕНИЯ PORTAGE[¶](#ОБЪЯВЛЕНИЯ-PORTAGE)

**inherit**

Inherit обеспечивает поддержку в portage т.н. еклассов функций, внешних по отношению к ебилдам и обладающих наследуемыми методами и данными. Они определяют функции и устанавливают типы данных как drop-in-замены, расширенные, упрощенные подпрограммы для самых обычных задач, с целью упорядочения процесса сборки. Вызов inherit не может зависеть от условий, которые могут меняться в пределах одного ебилда. Спецификация еклассов содержит только их имена, без расширения _.eclass_. Обратите также внимание, что оператор inherit должен предшествовать объявлению других переменных, если только эти переменные не используются в глобальном контексте еклассов.

## ФАЗОВЫЕ ФУНКЦИИ[¶](#ФАЗОВЫЕ-ФУНКЦИИ)

**pkg\_pretend**

Эта функция может быть определена начиная с **EAPI 4**; она используется для проверки выполнения различных требований. Она должна вызываться как можно раньше, до того, как будет предпринята попытка удовлетворить зависимости. Если функция обнаружит проблему, она должна вызвать **eerror** и **die**. Окружение (переменные, функции, временные каталоги и т.д.), используемое для выполнения **pkg\_pretend**, не сохраняется и, следовательно, не будет доступно на последующих фазах.

**pkg\_nofetch**

Если в переменной **RESTRICT** указано _fetch_, эта функция будет запущена, если не удается найти файлы в **SRC\_URI**. Таким образом удобно сообщать пользователю, **как** получить данные файлы. Достаточно выдать сообщение и нормально завершить работу функции; не завершайте ее вызовом **die**.

**pkg\_setup**

Эта функция может использоваться в том случае, если пакету требуется особая настройка или проверка, прежде чем будут выполняться другие действия.   
Исходный рабочий каталог ${PORTAGE\_TMPDIR}.

**src\_unpack**

Эта функция используется для распаковки всех исходных текстов, указанных в _A_, в каталог _WORKDIR_. Если эта функция в сценарии ebuild не определена, вызывается _unpack ${A}_. В этой функции производится наложение патчей и выполняются все остальные изменения, необходимые перед конфигурированием/компиляцией.   
Исходный рабочий каталог $WORKDIR.

**src\_prepare**

Все действия по подготовке исходного кода, в частности, наложение патчей, должны выполняться в этой функции. Она поддерживается в версиях EAPI начиная с **EAPI 2**.  
Исходный рабочий каталог $S.

**src\_configure**

Все необходимые действия по конфигурированию должны выполняться в этой функции. Она поддерживается в версиях EAPI начиная с **EAPI 2**.   
Исходный рабочий каталог $S.

**src\_compile**

В **EAPI 2** и ниже все необходимые шаги по конфигурированию и компиляции должны выполняться в этой функции; начиная с **EAPI 2** она отвечает лишь за компиляцию.  
Исходный рабочий каталог $S.

**src\_test**

Запускает все тест-кейсы, определенные для данного пакета. По умолчанию будет выполнено 'make check', а затем 'make test'.   
Исходный рабочий каталог $S.

**src\_install**

Должна содержать все необходимое для установки пакета во временном _каталоге установки_.  
Исходный рабочий каталог $S.

Начиная с **EAPI 4**, если _src\_install_ не определена, используется следующее умолчание:

    
    src_install() { 
        if [[ -f Makefile || -f GNUmakefile || -f makefile ]] ; then 
            emake DESTDIR="${D}" install 
        fi 
    
        if ! declare -p DOCS &>/dev/null ; then 
            local d 
            for d in README* ChangeLog AUTHORS NEWS TODO CHANGES \ 
                    THANKS BUGS FAQ CREDITS CHANGELOG ; do 
                [[ -s "${d}" ]] && dodoc "${d}" 
            done 
        elif [[ $(declare -p DOCS) == "declare -a "* ]] ; then 
            dodoc "${DOCS[@]}" 
        else 
            dodoc ${DOCS} 
        fi 
    } 
    

**pkg\_preinst** **pkg\_postinst**

В этих функциях должны выполняться все модификации текущей файловой системы, необходимые до и после включения пакета в дерево. Здесь также необходимо помещать комментарий для пользователя, выводимый в конце выполнения функции.  
Исходный рабочий каталог $PWD.

**pkg\_prerm** **pkg\_postrm**

Аналогично функциям pkg\_\*inst, но для исключения пакета из дерева.  
Исходный рабочий каталог $PWD.

**pkg\_config**

Эта функция должна содержать необязательные основные шаги по конфигурированию.  
Исходный рабочий каталог $PWD.

## ВСПОМОГАТЕЛЬНЫЕ ФУНКЦИИ[¶](#ВСПОМОГАТЕЛЬНЫЕ-ФУНКЦИИ)

### Фазы[¶](#Фазы)

**default**

Вызывает фазовые функции по умолчанию для текущей фазы выполнения. Эта функция поддерживается начиная с **EAPI 2**.

**default\_\***

Начиная с **EAPI 2** функции pkg\_nofetch и src\_\* с параметрами по умолчанию доступны через функцию с именем, начинающимся с default\_ и заканчивающимся соответствующим именем фазовой функции. Например, вызвав функцию default\_src\_compile, вы фактически запускаете функцию src\_compile с параметрами по умолчанию.
Фазовые функции по умолчанию

default\_pkg\_nofetch

default\_src\_unpack

default\_src\_prepare

default\_src\_configure

default\_src\_compile

default\_src\_test

### Разное[¶](#Разное)

**die** _\[причина\]_

Вызывает прекращение работы текущего процесса emerge. Выводимая при этом информация будет включать _причину_.

Начиная с **EAPI 4** все вспомогательные функции автоматически вызывают **die** при любой ошибке. Вызывы вспомогательных функций могут иметь префиксом функцию **nonfatal**, дабы ошибки не рассматривались системой как фатальные.

**nonfatal** _<вспомогательная функция\>_

Выполняет _вспомогательную функцию_, но в случае ошибки _не вызывает_ **die**. Функция **nonfatal** доступна начиная с **EAPI 4**.

**use** _<элемент USE\>_

Если _элемент USE_ указан в переменной **USE**, функция без дополнительных сообщений возвращает 0 ("истинно"). Если же _элемент USE_ в переменной **USE** не указан, функция без дополнительных сообщений возвращает 1 ("ложно"). Если вам нужен подробный вывод **use**, используйте вспомогательную функцию **usev**.

_Пример:_

    
    if use gnome ; then 
        guiconf="--enable-gui=gnome --with-x" 
    elif use gtk ; then 
        guiconf="--enable-gui=gtk --with-x" 
    elif use X ; then 
        guiconf="--enable-gui=athena --with-x" 
    else 
        # gui-версия собираться не будет 
        guiconf="" 
    fi 
    

**usex** _<USE-флаг\>_ _\[вывод, если истинно\]_ _\[вывод, если ложно\]_ _\[суффикс, если истинно\]_ _\[суффикс, если ложно\]_

Если USE-флаг установлен, то будет выполнено echo \[true output\]\[true suffix\] (по умолчанию "yes"), иначе echo \[false output\]\[false suffix\] (по умолчанию "no"). Функция **usex** доступна начиная с **EAPI 5**.

**use\_with** _<элемент USE\>_ _\[имя configure\]_ _\[опция configure\]_

Эта функция удобна для создания специфических опций, передаваемых сценарию configure. Если _элемент USE_ указан в переменной **USE**, будет выведена строка _--with-\[имя configure\]=\[опция configure\]_. Если _опция configure_ не указана, будет выведено только _--with-\[имя configure\]_. Если _элемент USE_ не указан в переменной **USE**, будет выведена строка _--without-\[имя configure\]_. Если _имя configure_ не указано, вместо него будет использоваться _элемент USE_. Начиная с **EAPI 4** добавлено распознавание пустого аргумента _опция configure_. В **EAPI 3** и ниже пустая _опция configure_ обрабатывается так, как если бы она не была указана.

_Примеры:_

    
    USE="opengl" 
    myconf=$(use_with opengl) 
    (новое значение myconf - "--with-opengl") 
    
    USE="jpeg" 
    myconf=$(use_with jpeg libjpeg) 
    (новое значение myconf - "--with-libjpeg") 
    
    USE="" 
    myconf=$(use_with jpeg libjpeg) 
    (новое значение myconf - "--without-libjpeg") 
    
    USE="sdl" 
    myconf=$(use_with sdl SDL all-plugins) 
    (новое значение myconf - "--with-SDL=all-plugins") 
    

**use\_enable** _<USE\>_ _\[имя configure\]_ _\[опция configure\]_

Аналогична описанной выше **use\_with**, но с опциями configure _--enable-_ вместо _--with-_ и _--disable-_ вместо _--without-_. Начиная с **EAPI 4** добавлено распознавание пустого аргумента _опция configure_. В **EAPI 3** и ниже пустая _опция configure_ обрабатывается так, как если бы она не была указана.

**hasv** _<элемент\>_ _<список элементов\>_

Если _элемент_ входит в _список элементов_, он выводится и функция **hasv** возвращает 0; в противном случае не выводится ничего, а функция возвращает 1\. Как говорилось выше для use, существует версия этой фукции, которая ничего не выводит, **has**. Используйте **has** во всех случаях, когда вывод информации не нужен. В частности, никогда не используйте вывод для вычислений.   
Разделитель _списка элементов_ определяется переменной _IFS_. По умолчанию значение этой переменной - ' ' или пробел. Это переменная **bash**(1).

**has\_version** _<категория/пакет-версия\>_

Проверяет, установлен ли в системе пакет _категория/пакет-версия_. Параметр может принимать любые значения, допустимые для переменной **DEPEND**. Функция возвращает 0 если пакет, указанный аргументом, установлен, иначе возвращает 1\. Начиная с **EAPI 5** здесь можно использовать опцию --host-root, чтобы запрос относился к корню хоста вместо ${ROOT}.

**best\_version** _<пакет\>_

Эта функция ищет _пакет_ в текущей базе данных установленных программ и выдает "лучшую версию" устанавливаемого пакета.Начиная с **EAPI 5** здесь можно использовать опцию --host-root, чтобы запрос относился к корню хоста вместо ${ROOT}.

_Пример:_

VERINS="$(best\_version net-ftp/glftpd)"   
(теперь VERINS имеет значение "net-ftp/glftpd-1.27", если установлен glftpd-1.27)

### Ловушки[¶](#Ловушки)

**register\_die\_hook** _\[имена функций\]_

Привязывает вызов одной или более функций к ошибке ебилда, в том числе в случае конфликта с другими пакетами.

**register\_success\_hook** _\[имена функций\]_

Привязывает вызов одной или более функций к успешной сборке и/или установке ебилда.

### Вывод[¶](#Вывод)

**einfo** _"текущее сообщение"_

Функция аналогична **elog**, но должна использоваться применительно к сообщениям, не критичным для пользователя (таким как сообщение о ходе сборки или вывод состояния операции).

**elog** _"важная информация"_

Если необходимо вывести важное сообщение, которое пользователь обязательно должен прочитать, используйте функцию **elog**. Она работает так же, как **echo**(1), но предоставляет более подробный вывод, привлекающий внимание пользователя. Кроме того, portage внесет данное сообщение в журнал, чтобы можно было к нему вернуться.

**ewarn** _"предупреждение"_

Аналогична **einfo**, но должна использоваться для вывода пользователю предупреждающих сообщений.

**eqawarn** _"предупреждение QA"_

Аналогична **einfo**, но должна использоваться для вывода пользователю предупреждающих сообщений по QA.

**eerror** _"сообщение об ошибке"_

Аналогична **einfo**, но должна использоваться для вывода пользователю сообщений об ошибках.

**ebegin** _"полезное сообщение"_

Аналогично функции **einfo**, выводит _полезное сообщение_ и сообщает о том, что выполнение последующей операции может занять некоторое время. По завершении должна вызываться функция **eend**.

**eend** _<состояние\>_ _\["сообщение об ошибке"\]_

После того, как отработала функция **ebegin**, выводит сообщение, маркированное либо "OK" (при успешном завершении), либо "!!" (в случае ошибки). Если _состояние_ не равно нулю, будет выведено дополнительное _сообщение об ошибке_.

### Распаковка[¶](#Распаковка)

**unpack** _<исходный код\>_ _\[другие исходные коды\]_

Эта функция распаковывает и/или разархивирует _исходный код_ в текущий каталог. Он будет добавлен в переменную **DISTDIR**.

### Компиляция[¶](#Компиляция)

**econf** _\[опции configure\]_

Эта функция используется вместо configure. Она выполняет следующее:   

    
    ${ECONF_SOURCE:-.}/configure \ 
        ${CBUILD:+--build=${CBUILD}} \ 
        --datadir="${EPREFIX}"/usr/share \ 
        --host=${CHOST} \ 
        --infodir="${EPREFIX}"/usr/share/info \ 
        --localstatedir="${EPREFIX}"/var/lib \ 
        --prefix="${EPREFIX}"/usr \ 
        --mandir="${EPREFIX}"/usr/share/man \ 
        --sysconfdir="${EPREFIX}"/etc \ 
        ${CTARGET:+--target=${CTARGET}} \ 
        --disable-dependency-tracking \ 
        ${EXTRA_ECONF} \ 
        опции configure || die "econf failed" 
    

Обратите внимание, что переменная _EXTRA\_ECONF_ отведена для пользователей и не предназначена для написания ebuild-сценариев. Если небходимо передать configure дополнительные опции, делайте это с помощью **econf**. Заметьте также, что, если сценарий configure выдает ошибку, **econf** автоматически вызывает функцию **die**. Начиная с **EAPI 3** функция **econf** обращается к переменной **${EPREFIX}**, которая в предыдущих версиях **EAPI** не использовалась, а начиная с **EAPI 4** - добавляет _--disable-dependency-tracking_ к аргументам, если в выводе команды _configure --help_ встречается строка _disable-dependency-tracking_. Начиная с **EAPI 5**, **econf** добавляет к аргументам _disable-silent-rules_, если в выводе _configure --help_ встречается строка\_disable-silent-rules\_.

**emake** _\[опции make\]_

Эта функция используется вместо make. Она выполняет 'make ${MAKEOPTS} _опции make_' (согласно настройкам в make.globals); по умолчанию выставлено MAKEOPTS="-j2".

**\*\*\*ВНИМАНИЕ\*\*\***   
Прежде чем использовать **emake**, убедитесь, что сборка возможна при распараллеливании (make -j2). Важно знать это наверняка, поскольку распараллеливание хотя и не всегда, но _может_ приводить к ошибкам. Если при параллельной сборке пакет выдает ошибку, которую не удается разрешить, вместо 'make' воспользуйтесь '**emake** -j1'.

### Установка[¶](#Установка)

**einstall** _\[опции make\]_

Эта функция используется вместо make install. Она выполняет следующее:   

    
    make \ 
        prefix=${ED}/usr \ 
        datadir=${ED}/usr/share \ 
        infodir=${ED}/usr/share/info \ 
        localstatedir=${ED}/var/lib \ 
        mandir=${ED}/usr/share/man \ 
        sysconfdir=${ED}/etc \ 
        ${EXTRA_EINSTALL} \ 
        опции make \ 
        install 
    

**Не используйте** эту функцию вместо 'emake install DESTDIR=${D}': данный способ установки предназначен преимущественно для пакетов, собираемых с помощью make. Не используйте также переменную _EXTRA\_EINSTALL_, так как она зарезервирована для пользователей.

**prepall**

**prepalldocs**

**prepallinfo**

**prepallman**

**prepallstrip**

Эти функции удобны в случае, когда пакет устанавливается в каталог **${D}** с помощью сценариев (например, make-файлов). Если необходимо гарантировать, что библиотеки являются выполняемыми, файлы aclocal установлены правильно, все файлы doc/info/man упакованы, из выполняемых файлов удалена отладочная информация, используйте этот набор функций.

**prepall:**

Запускает функции **prepallman**, **prepallinfo**, **prepallstrip**, устанавливает для библиотек права +x, а затем проверяет каталоги aclocal.  
Обратите внимание, что функция **prepalldocs** при этом _\*не вызывается\*_.

**prepalldocs:**

Упаковывает все doc-файлы в каталоге ${ED}/usr/share/doc.

**prepallinfo:**

Упаковывает все info-файлы в каталоге ${ED}/usr/share/info.

**prepallman:**

Упаковывает все man-файлы в каталоге ${ED}/usr/share/man.

**prepallstrip:**

Удаляет отладочную инфомацию из всех выполняемых файлов - в частности, из библиотек.

**prepinfo** _\[каталог\]_

**prepman** _\[каталог\]_

**prepstrip** _\[каталог\]_

Аналогична функциям **prepall**, но с небольшими различиями.

**prepinfo:**

Если _каталог_ не указан аргументом, то **prepinfo** принимает за каталог _usr_. Затем **prepinfo** упакует все файлы в каталоге ${ED}/_dir_/info.

**prepman:**

Если _каталог_ не указан аргументом, то **prepman** принимает за каталог _usr_. Затем **prepman** упакует все файлы в каталоге ${ED}/_dir_/man/\*/.

**prepstrip:**

Из всех файлов в каталоге ${ED}/_dir_ удаляется отладочная информация. Можно указывать несколько каталогов.

**docompress** _<путь\> \[другие пути\]_

Начиная с **EAPI 4** вспомогательная функция **docompress** используется для управления списками файлов на включение или исключение для необязательной упаковки. Если первый аргумент - **-x**, каждый из последующих аргументов будет добавлен в список на исключение. Без -x все аргументы будут добавлены в список на включение. Изначально список на включение содержит каталоги _/usr/share/doc_, _/usr/share/info_, and _/usr/share/man_. Изначальный список на исключение содержит каталог\_/usr/share/doc/${PF}/html\_.

Необязательная упаковка выполняется после того, как отработала функция **src\_install**, но до того, как начнет выполняться любая последующая фазовая функция. Для каждого элемента списка на включение временно принимается префиксом значение переменной **D**. Далее:

Если это директория, система будет действовать так, как если бы каждый файл или каталог, находящийся непосредственно в этой директории, состоял в списке на включение.

Если это файл, он может быть упакован, если только он не был исключен (см. ниже).

Если элемент не существует, он будет проигнорирован.

Подлежит ли элемент исключению, определяется следующим образом: для каждого элемента списка на исключение временно принимается префиксом значение переменной **D**. Далее:

Если это директория, система будет действовать так, как если бы каждый файл или каталог, находящийся непосредственно в данном каталоге, состоял в списке на исключение.

Если это файл, он не будет упакован.

Если элемент не существует, то он будет проигнорирован.

**dosed** _"s:orig:change:g" <имя файла\>_

Начиная с **EAPI 4**, вспомогательная функция **dosed** не существует. Ебилды должны вызывать команду **sed(1)** напрямую (принимая, что это sed GNU).

Выполняет команду sed для файла _имя файла_ в каталоге ${ED}. Если никакого выражения не задано, то _"s:${D}::g"_ выступает как выражение по умолчанию. Обратите внимание, что для этого выражения **НЕ ИСПОЛЬЗУЕТСЯ** префикс смещения.   
**'dosed\\** **s:/usr/local:/usr:g** **\\** **/usr/bin/some-script'** выполняет команду для файла ${ED}/usr/bin/сценарий.

**dodir** _<путь\>_

Создает каталог в ${ED}.   
**'dodir\\** **/usr/lib/apache'** создает ${ED}/usr/lib/apache. Обратите внимание, что функции do\* будут вызывать функцию **dodir**.

**diropts** _\[опции для install(1)\]_

Может использоваться для задания опций утилиты install, к которым обращается функция **dodir**. Значение по умолчанию - _-m0755_.

**into** _<путь\>_

Назначает корневой каталог (_DESTTREE_) для других функций, таких как **dobin**, **dosbin**, **doman**, **doinfo**, **dolib**.   
Корневой каталог по умолчанию - /usr.

**keepdir** _<путь\>_

Заставляет portage оставить каталог, даже если он пуст. Работает аналогично функции **dodir**.

**dobin** _<бинарный файл\> \[другие бинарные файлы\]_

Устанавливает один или несколько _бинарных файлов_ в каталог _DESTTREE_/bin. Функция создает все необходимые каталоги.

**dosbin** _<бинарный файл\> \[другие бинарные файлы\]_

Устанавливает один или несколько _бинарных файлов_ в каталог _DESTTREE_/sbin. Функция создает все необходимые каталоги.

**doinitd** _<сценарий init.d\> \[другие сценарии init.d\]_

Устанавливает сценарии _init.d_ для Gentoo по стандартному для init.d пути (/etc/init.d/). Функция создает все необходимые каталоги.

**doconfd** _<файл conf.d\> \[другие файлы conf.d\]_

Устанавливает файлы _conf.d_ для Gentoo по стандартному для conf.d пути (/etc/conf.d/). Функция создает все необходимые каталоги.

**doenvd** _<запись env.d\> \[другие записи env.d\]_

Устанавливает записи _env.d_ для Gentoo по стандартному для env.d пути (/etc/env.d/). Функция создает все необходимые каталоги.

**dolib** _<библиотека\>_ _\[другие библиотеки\]_

**dolib.a** _<библиотека\>_ _\[другие библиотеки\]_

**dolib.so** _<библиотека\>_ _\[другие библиотеки\]_

Устанавливает одну или несколько библиотек в каталог _DESTTREE_/lib. Функция создает все необходимые каталоги.

**libopts** _\[опции для install(1)\]_

Может использоваться для задания опций утилите install, к которым обращаются функции **dolib**. Значение по умолчанию - _-m0644_.

**doman** _\[-i18n=<локаль\>\]_ _<man-файл\> \[другие man-файлы\]_

Устанавливает файлы man-руководств в каталог /usr/share/man/man\[0-9\], в зависимости от суффикса файла. Если это необходимо, файлы будут упакованы. Опция _-i18n_ позволяет устанавливать руководства на определенном языке. Затем man-файлы будут установлены в каталог /usr/share/man/_<локаль\>_/man\[0-9\]. Начиная с **EAPI 2** man-страницы для определенной локали, в имени которых содержится суффикс локали, устанавливаются в каталог /usr/share/man/_<локаль\>_/man\[0-9\], причем часть имени файла, обозначающая локаль, удаляется, а опция _-i18n_ будет проигнорирована. Например, если используется **EAPI 2**, man-страница с именем foo._<локаль\>_.1 будет установлена как /usr/share/man/_<локаль\>_/man1/foo.1\. Начиная с **EAPI 4** атрибут опции _-i18n_ имеет приоритет перед суффиксом локали в имени файла.

**dohard** _<имя файла\> <имя ссылки\>_

Начиная с **EAPI 4** вспомогательная функция **dohard** не существует. Ебилды должны вызывать утилиту **ln(1)** напрямую.

**dosym** _<имя файла\> <имя ссылки\>_

Выполняет команду ln, создавая тем самым символическую ссылку.

**doheader** _<имя файла\> \[другие файлы\]_

Устанавливает данные файлы заголовков в каталог /usr/include/ с правами по умолчанию _0644_ (можно переопределить через функцию **insopts**). Опция -r включит в обработку содержимое подкаталогов. Вспомогательная функция **doheader** доступна начиная с **EAPI 5**.

**dohtml** \_ \[-a типы-файлов\] \[-r\] \[-x игнорируемые-каталоги\] \[файлы-и-каталоги\]\_

Устанавливает файлы из списка файлов (разделяются пробелом) в каталог /usr/share/doc/${PF}/html, если файлы имеют расширение .htm, .html, .css, .js, .gif, .jpeg, .jpg или .png. Опция _-a_ позволяет ограничить действие определенными типами файлов, опция _-A_ добавляет типы к перечню по умолчанию, _-x_ определяет каталоги, которые необходимо пропустить (по умолчанию пропускается CVS), _-p_ определяет префикс документа, с опцией _-r_ каталоги обрабатываются рекурсивно.

**doinfo** _<info-файл\> \[другие info-файлы\]_

Устанавливает info-файлы в каталог _DESTDIR_/info. Все они автоматически архивируются с помощью gzip. Функция создает все необходимые каталоги.

**domo** \_<файл локали\> \[другие файлы локали\] \_

Устанавливает файлы локали в каталог _DESTDIR_/usr/share/locale/\[ЯЗЫК\], исходя из их суффикса. Функция создает все необходимые каталоги.

**fowners** _<права доступа\> <файл\> \[файлы\]_

**fperms** _<права доступа\> <файл\> \[файлы\]_

Выполняет chown (**fowners**) или chmod (**fperms**), назначая тем самым _права доступа к файлам_.

**insinto** _\[путь\]_

Устанавливает корневой каталог для функции **doins**.   
По умолчанию им является /.

**insopts** _\[опции для install(1)\]_

Может быть использована для задания опций утилите install, используемой в функции **doins**. Значение по умолчанию - _-m0644_.

**doins** _<файл\> \[другие файлы\]_

Устанавливает файлы по пути, который управляется функцией **insinto**. Эта функция использует утилиту **install**(1). Все необходимые каталоги будут созданы. Опция -r устанавливает рекурсивный режим. Начиная с **EAPI 4** и **doins**, и **newins** сохраняют символические ссылки, тогда как в **EAPI 3** и более ранних версиях символические ссылки не сохранялись, а происходило разыменование.

**exeinto** _\[путь\]_

Устанавливает корневой каталог для функции **doexe**.   
По умолчанию им является /.

**exeopts** _\[опции для install(1)\]_

Может использоваться для задания опций утилите install, используемых в функции **doexe**. Значение по умолчанию - _-m0755_.

**doexe** _<исполняемый файл\> \[другие исполняемые файлы\]_

Устанавливает исполняемые файлы в каталог, управляемый **exeinto**. Эта функция использует утилиту **install**(1). Функция создает все необходимые каталоги.

**docinto** _\[путь\]_

Назначает подкаталог, используемый функциями **dodoc** и **dohtml** при установке в дерево документов (на основе /usr/share/doc/${PF}/). По умолчанию подкаталога либо нет, либо установлено значение "".

**dodoc** _<документ\> \[другие документы\]_

Устанавливает один или несколько документов в каталог /usr/share/doc/${PF}/_<путь docinto\>_. Документы помечаются для упаковки. Функция создает все необходимые каталоги. Начиная с **EAPI 4** поддерживается рекурсивная обработка подкаталогов; чтобы включить ее, используйте опцию _-r_.

**newbin** _<прежний файл\> <новое имя файла\>_

**newsbin** _<прежний файл\> <новое имя файла\>_

**newinitd** _<прежний файл\> <новое имя файла\>_

**newconfd** _<прежний файл\> <новое имя файла\>_

**newenvd** _<прежний файл\> <новое имя файла\>_

**newlib.so** _<прежний файл\> <новое имя файла\>_

**newlib.a** _<прежний файл\> <новое имя файла\>_

**newman** _<прежний файл\> <новое имя файла\>_

**newinfo** _<прежний файл\> <новое имя файла\>_

**newins** _<прежний файл\> <новое имя файла\>_

**newexe** _<прежний файл\> <новое имя файла\>_

**newdoc** _<прежний файл\> <новое имя файла\>_

Все эти функции работают аналогично функциям **do**, но только с одним файлом, который устанавливается с _\[новым именем\]_. Начиная с **EAPI 5**, если первый параметр - дефис (-), происходит обращение к стандартному вводу.

## ПРИМЕРЫ[¶](#ПРИМЕРЫ)

    
    # Copyright 1999-2009 Gentoo Foundation 
    # Distributed under the terms of the GNU General Public License v2 
    # $Header: $ 
    
    EAPI="5" 
    
    inherit some_eclass another_eclass 
    
    DESCRIPTION="Super-useful stream editor (sed)" 
    HOMEPAGE="http://www.gnu.org/software/sed/sed.html" 
    SRC_URI="ftp://alpha.gnu.org/pub/gnu/${PN}/${P}.tar.gz" 
    
    LICENSE="GPL-2" 
    SLOT="0" 
    KEYWORDS="~x86" 
    IUSE="" 
    
    RDEPEND="" 
    DEPEND="nls? ( sys-devel/gettext )" 
    
    src_configure() { 
        econf 
            --bindir="${EPREFIX}"/bin 
    } 
    
    src_install() { 
        emake DESTDIR="${D}" install 
        dodoc NEWS README* THANKS AUTHORS BUGS ChangeLog 
    } 
    

## ФАЙЛЫ[¶](#ФАЙЛЫ)

Сценарий _/usr/sbin/ebuild.sh_.

Вспомогательные приложения в каталоге _/usr/lib/portage/bin_.

**/etc/make.conf**

Содержит переменные для процесса сборки; они имеют приоритет над заданными в make.defaults.

**/usr/share/portage/config/make.globals**

Содержит переменные по умолчанию для процесса сборки. Редактировать значения следует не здесь, а в файле /etc/make.conf.

**/etc/portage/color.map**

Содержит переменные для пользовательских настроек цветного вывода.

## СМ. ТАКЖЕ[¶](#СМ-ТАКЖЕ)

**[ebuild](ebuild.html)** **(1),** **[make.conf](.html)** **(5),** **[color.map](.html)** **(5)**

## БАГТРЕКЕР[¶](#БАГТРЕКЕР)

Об обнаруженных ошибках сообщайте на [http://bugs.gentoo.org/](http://bugs.gentoo.org/).

## АВТОРЫ[¶](#АВТОРЫ)

* Achim Gottinger <[achim@gentoo.org](mailto:achim@gentoo.org)\> 
* Mark Guertin <[gerk@gentoo.org](mailto:gerk@gentoo.org)\> 
* Nicholas Jones <[carpaski@gentoo.org](mailto:carpaski@gentoo.org)\> 
* Mike Frysinger <[vapier@gentoo.org](mailto:vapier@gentoo.org)\> 
* Arfrever Frehtes Taifersar Arahesis <[Arfrever.FTA@gmail.com](mailto:Arfrever.FTA@gmail.com)\> 
* Fabian Groffen <[grobian@gentoo.org](mailto:grobian@gentoo.org)\>

## ПЕРЕВОД[¶](#ПЕРЕВОД)

* Елена Гаврилова <[e.vl.gavrilova@yandex.ru](mailto:e.vl.gavrilova@yandex.ru)\>

  
Октябрь 2012