# EBUILD[¶](#EBUILD)

## НАЗВАНИЕ[¶](#НАЗВАНИЕ)

**ebuild** - низкоуровневый интерфейс системы портежей

## СИНТАКСИС[¶](#СИНТАКСИС)

**ebuild** _файл_ _команда_ _\[команда\]_ ...

## ОПИСАНИЕ[¶](#ОПИСАНИЕ)

Программа ebuild представляет собой прямой интерфейс системы Portage. Она обеспечивает возможность непосредственного взаимодействия с ебилдом при помощи специальных подкоманд или групп команд, выполняемых в контексте данного ебилда, и функций. Утилита ebuild принимает в качестве аргументов ebuild-сценарий и одну или более команд, подвергает сценарий синтаксическому анализу и выполняет указанные команды. Имеются отдельные команды для загрузки исходных файлов, их распаковки, компиляции, установки объектных файлов во временный каталог image, установки образа в локальную файловую систему, создания архива пакета из образа и т.д.

## ФАЙЛ[¶](#ФАЙЛ)

Должен быть рабочим ebuild-сценарием. Подробнее см. в руководстве по **[ebuild](ebuild.html)**(5).

## КОМАНДЫ[¶](#КОМАНДЫ)

По умолчанию portage выполняет все функции по порядку вплоть до указанной. Наприме, если вы дадите команду **compile**, то вызовете тем самым и предшествующие ей функции (такие как **setup** и **unpack**). Если вы хотите, чтобы запускалась только одна команда, вам следует добавить опцию _noauto_ в значение переменной окружения **FEATURES**. Подробнее см. в справке по **[make.conf](.html)**(5).

**help**

Выводит справочную информацию о программе в сжатом изложении, а также целый ряд сведений о пакете.

**setup**

Запускает все действия по настройке данного пакета, в том числе специфические системные тесты.

**clean**

Очищает временный каталог сборки, созданный Portage специально для этого ебилда. Временный каталог build обычно содержит извлеченный из архива исходный код, а также, возможно, так называемый установочный образ (все файлы, которые будут установлены в локальную файловую систему или сохранены в пакете). Расположение каталога сборки определяется значением переменной PORTAGE\_TMPDIR. Чтобы узнать ее текущее значение, выполните _emerge --info_. О том, как переопределить эту переменную, см. в справке по **[make.conf](.html)**(5).

Примечание: Portage удаляет практически все данные, оставшиеся после успешной установки пакета, за исключением тех случаев, когда в переменной FEATURES явно указано noclean. Если вы добавите noclean в значение FEATURES, очень скоро большой объем дискового пространства будет занят ненужными файлами. Не рекомендуется пользоваться этим режимом постоянно, а лишь в том случае, если исходники пакетов потребуются вам после установки. Впрочем, возможно и ручное удаление этих файлов: для этого следует выполнить _rm -rf /var/tmp/portage_.

**fetch**

Проверяет, все ли источники данных, фигурирующие в SRC\_URI, доступны в каталоге DISTDIR (подробнее см. в **[make.conf](.html)**(5)) и имеют верную контрольную сумму. Если исходные коды недоступны, будет предпринята попытка загрузить их с серверов, адреса которых указаны в SRC\_URI. Если для того или иного файла имеется несколько адресов загрузки, Portage проверит каждый из них и выберет тот сервер, который ближе. (Точность этого выбора на данный момент не гарантируется.) В первую очередь всегда обрабатываются зеркала Gentoo Linux, содержащиеся в переменной GENTOO\_MIRRORS. Если по какой-либо причине md5-дайджест текущих или только что загруженных исходных кодов не совпадает с дайджестом в files/digest-\[пакет\]-\[версия-ревизия\], выводится предупреждение, и ебилд завершает работу с кодом ошибки 1\.

**digest**

В настоящее время - эквивалент команды _manifest_.

**manifest**

Обновляет Manifest-файл пакета. В результате создаются контрольные суммы для всех файлов, обнаруженных в одном каталоге с обрабатываемым ебилдом, а также содержимое вложенных каталогов подкаталога files. При этом контрольные суммы генерируются и для всех файлов, перечисленных в SRC\_URI для каждого ебилда. Подробнее о поведении данной команды, см. в разделе о смысле значения _assume-digests_ переменной **FEATURES** справочного руководства по **[make.conf](.html)**(5). Если вы не хотите, чтобы дайджесты принимались неявно, см. опцию **--force**.

**unpack**

Извлекает исходные коды в подкаталог каталога _build_ (BUILD\_PREFIX), вызывая функцию _src\_unpack()_ внутри файла ебилда. Если параметры функции src\_unpack() не были указаны, для распаковки всех файлов, перечисленных в SRC\_URI, будет использована стандартная src\_unpack(). Как правило, исходники распаковываются в каталог${BUILD\_PREFIX}/\[пакет\]-\[версия-ревизия\]/work. Обращаться к нему можно с помощью переменной ${WORKDIR}.

Создавая ебилд самостоятельно, убедитесь, что переменная S (каталог исходных файлов), определенная в начале ebuild-сценария, указывает на каталог, в котором действительно содержатся распакованные исходные коды. По умолчанию он определяется как ${WORKDIR}/${P}, поэтому, как правило, ничего не требуется исправлять. Функция src\_unpack() также отвечает за наложение патчей перед компиляцией пакетов.

**prepare**

Подготавливает извлеченные из архива исходные коды, вызывая функцию _src\_prepare()_, параметры запуска которой определены в ebuild-файле. При запуске src\_prepare() текущим рабочим каталогом становится ${S}. Данная функция поддерживается начиная с **EAPI 2**.

**configure**

Производит конфигурирование распакованных исходных кодов, вызывая функцию _src\_configure()_, параметры запуска которой определены в ebuild-файле. При запуске src\_configure() текущим рабочим каталогом становится ${S}. Данная функция поддерживается начиная с **EAPI 2**.

**compile**

Компилирует распакованные исходные коды, вызывая функцию _src\_compile()_, параметры запуска которой определены в ebuild-файле. При запуске src\_compile() текущим рабочим каталогом становится ${S}. По завершении работы src\_compile() исходные коды должны быть полностью скомпилированы.

**test**

Выполняет специальные тесты для отдельных пакетов, проверяя сборку.

**preinst**

Выполняет специальные действия для отдельных пакетов, которые требуется произвести до установки пакета в текущую файловую систему.

**install**

Устанавливает пакет во временный каталог _install_, вызывая функцию _src\_install()_. По завершении каталог установки в (${BUILD\_PREFIX}/\[пакет\]-\[версия-ревизия\]/image) будет содержать все файлы, которые должны быть либо установлены в текущую файловую систему, либо включены в бинарный пакет.

**postinst**

Выполняет специальные действия для отдельных пакетов, которые требуется произвести после установки пакета в текущую файловую систему. Как правило, при этом выводятся полезные сообщения.

**qmerge**

Эта функция устанавливает все файлы в каталог _install_ в текущей файловой системе. Это производится следующим образом: сначала запускается функция _pkg\_preinst()_ (если указана). Затем все файлы устанавливаются в файловую систему, а их дайджесты контрольной суммы записываются в _/var/db/pkg/${CATEGORY}/${PN}-${PVR}/CONTENTS_. Наконец, по завершении установки всех файлов выполняется функция _pkg\_postinst()_ (если указана).

**merge**

Обычно для установки ебилда, необходимо последовательно выполнить следующие действия: _fetch_, _unpack_, _compile_, _install_ и _qmerge_. Если вам нужно только установить ебилд, вы можете использовать данную команду: она сама выполнит все перечисленные операции и остановится в процессе выполнения только в том случае, если какая-либо функция отрабатывает с ошибкой.

**unmerge**

Эта команда сначала вызывает функцию _pkg\_prerm()_ (если та указана). Затем она удаляет все файлы из текущих файловых систем, файл содержимого пакета для которых имеет неверные контрольную сумму и время изменения. Все пустые каталоги удаляются вместе с вложенными. Наконец, команда запускает функцию _pkg\_postrm()_ (если та указана). Можно сначала установить новую версию пакета, а затем удалить прежнюю - собственно, именно в этом заключается рекомендуемый метод обновления.

**prerm**

Запускает для определенного пакета действия, которые необходимо выполнить до удаления пакета из файловой системы. См. также _unmerge_.

**postrm**

Запускает для определенного пакета действия, которые необходимо выполнить после удаления пакета из файловой системы. См. также _unmerge_.

**config**

Запускает для определенного пакета действия, которые необходимо выполнить до начала установки. Как правило, это настройка конфигурационных файлов или другие настроечные действия, назначаемые пользователем.

**package**

Эта команда очень напоминает _merge_, за исключением того, что после загрузки, распаковки, компиляции и установки создается .tbz2-архив бинарного пакета, который затем сохраняется в каталоге **PKGDIR** (см. **[make.conf](.html)**(5)).

**rpm**

Собирает RPM-пакет RedHat из файлов во временном каталоге _install_. На данный момент сведения о зависимостях ебилда не включаются в RPM.

## ОПЦИИ[¶](#ОПЦИИ)

**--debug**

Запустить bash с опцией -x option, в результате чего стандартный вывод будет включать подробную отладочную информацию.

**--color < y | n \>**

Включить или отключить цветное отображение. Эта опция переопределяет значение переменной _NOCOLOR_ (см. **make.conf**(5)) и может быть использована для принудительного назначения цвета в том случае, если стандартный вывод - не терминал (по умолчанию цвет включен только в том случае, если стандартный вывод - терминал).

**--force**

При использовании в связке с командой digest или manifest данная опция принудительно генерирует новые дайджесты для всех файлов исходного кода, относящихся к данному ебилду. Если в каталоге ${DISTDIR} требуемых исходников нет, они будут автоматически загружены.

**--ignore-default-opts**

Не использовать переменную окружения _EBUILD\_DEFAULT\_OPTS_.

**--skip-manifest**

Пропустить проверку Manifest-файлов.

## БАГТРЕКЕР[¶](#БАГТРЕКЕР)

Об обнаруженных ошибках сообщайте на [http://bugs.gentoo.org/](http://bugs.gentoo.org/)

## АВТОРЫ[¶](#АВТОРЫ)

* Achim Gottinger <[achim@gentoo.org](mailto:achim@gentoo.org)\> 
* Daniel Robbins <[drobbins@gentoo.org](mailto:drobbins@gentoo.org)\> 
* Nicholas Jones <[carpaski@gentoo.org](mailto:carpaski@gentoo.org)\> 
* Mike Frysinger <[vapier@gentoo.org](mailto:vapier@gentoo.org)\>

## ФАЙЛЫ[¶](#ФАЙЛЫ)

**/etc/make.conf**

Содержит переменные сборки, имеющие приоритет перед значениями, указанными в файле make.globals.

**/etc/portage/color.map**

Содержит переменные, позволяющие назначать пользовательские настройки цветного вывода.

## СМ. ТАКЖЕ[¶](#СМ-ТАКЖЕ)

**[emerge](.html)** **(1),** **[ebuild](ebuild.html)** **(5),** **[make.conf](.html)** **(5),** **[color.map](.html)** **(5)**

Сценарий _/usr/sbin/ebuild.sh_.

Вспомогательные приложения в каталоге _/usr/lib/portage/bin_.

## ПЕРЕВОД[¶](#ПЕРЕВОД)

* Елена Гаврилова <[e.vl.gavrilova@yandex.ru](mailto:e.vl.gavrilova@yandex.ru)\>

  
Февраль 2011