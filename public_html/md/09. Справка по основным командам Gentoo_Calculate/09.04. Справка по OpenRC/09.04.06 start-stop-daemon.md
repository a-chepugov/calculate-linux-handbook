# START-STOP-DAEMON[¶](#START-STOP-DAEMON)

## НАЗВАНИЕ[¶](#НАЗВАНИЕ)

**start-stop-daemon** - обеспечение запуска и остановки демонов

## СИНТАКСИС[¶](#СИНТАКСИС)

**start-stop-daemon** **-S , -start** _демон_ \[--\] \[_аргументы_ \] **start-stop-daemon -K , -stop** _демон_ **start-stop-daemon -s , -signal** _signal демон_

## ОПИСАНИЕ[¶](#ОПИСАНИЕ)

Утилита **start-stop-daemon** обеспечивает надежный метод запуска и остановки демонов, а также передачи им сигнала. Если не используется ни опция **-K , -stop**, ни **-s , -signal**, подразумевается, что демон необходимо запустить. Если демон не запускается самостоятельно в фоновом режиме и не создает файл идентификатора процесса, это может безопасно выполнить **start-stop-daemon**.

Если **start-stop-daemon** используется для той или иной службы OpenRC, OpenRC может проверить, работает ли демон. Если нет, то служба помечается как аварийно остановленная.

Ниже приводятся опции, служащие для указания демона и способа его запуска или остановки:

**-x , -exec** _демон_

Запускаемый или останавливаемый _демон_. Если эта опция не указана, то будет использован первый аргумент вне опций.

**-p , -pidfile** _файл идентификатора процесса_

При запуске демона он за разумное время должен создать рабочий файл идентификатора процесса. При остановке будут остановлены только процессы, перечисленные в файле идентификатора.

**-n , -name** _имя_

Определяет демон по имени процесса, а не по файлу идентификатора или по имени исполняемого файла.

**-i , -interpreted**

При выборе процесса по имени необходимо убедиться, что ему соответствует подходящий интерпретатор. Как только, например, запускается демон foo, **start-stop-daemon** ищет процесс. Если интерпретируемый демон изменяет свое имя процесса, это не будет работать.

**-u , -user** _пользователь_ \[:_группа_ \]

Запускает демон от _пользователя_ и соответственно обновляет значение $HOME или останавливает демоны, принадлежащие _пользователю_. При желании вы можете добавить и _группу_.

**-t , -test**

Только отображает сведения о действии/-ях, которые должны быть выполнены, ничего не делая. Возвращается то же значение, что и в случае действительно запуска и отработки команды.

**-v , -verbose**

Отображает сведения о действии/-ях непосредственно перед его/их выполнением.

**-P , -progress**

Отображает ход выполнения в консоли: одна точка обозначает секунду ожидания.

Следующие опции используются только при запуске демонов:

**-a , -startas** _имя_

Заменяет имя процесса демона на указанное _имя_. Это заменит лишь первый аргумент, передаваемый демону.

**-b , -background**

Принудительно запускает демон в фоновом режиме. Некоторые демоны не создают идентификационных файлов - их удобно запускать в фоне и использовать эту опцию в связке с **-m , -make-pidfile** для создания рабочего файла идентификатора.

**-d , -chdir** _путь_

Перед запуском демона изменяет рабочий каталог на указанный.

**-r , -chroot** _путь_

Перед запуском демона выполняет chroot в каталоге по указанному _пути_. Другие пути, например, путь доступа к демону, адрес нового корневого каталога root и файла идентификатора процесса, должны быть относительными к chroot.

**-c , -chuid** _пользователь_

Аналогично опции **-u , -user**.

**-e , -env** _VAR=VALUE_

Присваивает переменной окружения VAR значение VALUE.

**-g , -group** _группа_

Запускает демон в группе.

**-k , -umask** _режим_

Задает маску файла демона.

**-m , -make-pidfile**

Сохраняет идентификатор процесса демона в файле, указанном в опции **-p, -pidfile**. Имеет смысл только применительно к демонам, запущенным в основном режиме, которые принудительно переводятся в фоновый режим опцией **--b, -background**.

**-I , -ionice** _класс_ \[:_данные_ \]

Изменяет приоритет ввода-вывода для демона. Аргумент _класс_ может иметь значение 0 - нет, 1 - real time (приоритетный доступ), 2 - best effort (приоритет определяется планировщиком) и 3 - idle ( доступ только тогда, когда другие процессы не требуют ввода/вывода). Аргумент _данные_ может принимать значения от 0 до 7 включительно.

**-N , -nice** _уровень_

Изменяет приоритет запуска демона.

**-1 , -stdout** _журнал_

При запуске с опцией **-background** перенаправляет стандартный вывод процесса в журнал. В качестве аргумента необходимо указывать абсолютный путь доступа к файлу, но относительный к пути, опционально заданному опцией **-r , -chroot**. Журнал может быть и именованным каналом.

**-w , -wait** _время_

После запуска ожидать указанное _время_ (в миллисекундах), затем проверить, продолжает ли демон работу. Эта опция удобна для демонов, которые проверяют конфигурацию после ветвления или устранения "гонок", когда файл идентификатора записывается после ветвления процесса.

**-2 , -stderr** _журнал_

Эта опция аналогична **-1, -stdout**, но со стандартным выводом ошибок.

Следующие опции используются только для остановки демонов:

**-R , -retry** _пауза | сигнал / пауза_

Вы можете указать либо продолжительность паузы в секундах, либо несколько пар сигнал/пауза для расписания остановки демонов. Если опция не задана, будет использовано значение по умолчанию SIGTERM/5\.

## ОКРУЖЕНИЕ[¶](#ОКРУЖЕНИЕ)

С помощью переменной\_SSD\_NICELEVEL\_ также можно устанавливать очередь запуска демонов, но приоритет будет иметь опция в командной строке.

Переменная _SSD\_STARTWAIT_ аналогична опции **-w, -wait**, описанной выше. /etc/rc.conf, **start-stop-daemon** ожидает проверки, продолжает ли демон работу.

## ПРИМЕЧАНИЕ[¶](#ПРИМЕЧАНИЕ)

Для синтаксического анализа опций **start-stop-daemon** использует **getopt**(3): этот инструмент позволяет принимать опцию с префиксом \`--', останавливая обработку текущих опций на данном этапе. Все последующие аргументы передаются демону, который запускает соответствующие службы, и используются при обнаружении демона, который необходимо остановить или которому необходимо передать сигнал.

## СМ. ТАКЖЕ[¶](#СМ-ТАКЖЕ)

**chdir**(2), **chroot**(2), **getopt**(3), **nice**(2), **rc\_find\_pids**(3)

## ОШИБКИ[¶](#ОШИБКИ)

Не обращаясь к файлу идентификатора процесса, **start-stop-daemon** не может остановить интерпретируемый демон, который уже не существует.

## ИСТОРИЯ[¶](#ИСТОРИЯ)

Впервые **start-stop-daemon** был использован в Debian.

Настоящая реализация стала результатом полной переработки изначальной версии: процесс ищет код в библиотеке OpenRC (librc, -lrc), чтобы к нему могли обращаться другие программы.

## АВТОРЫ[¶](#АВТОРЫ)

* Roy Marples <[roy@marples.name](mailto:roy@marples.name)\>

## ПЕРЕВОД[¶](#ПЕРЕВОД)

* Елена Гаврилова <[e.vl.gavrilova@yandex.ru](mailto:e.vl.gavrilova@yandex.ru)\>