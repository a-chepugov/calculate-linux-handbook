# Настройка Samba сервера[¶](#Настройка-Samba-сервера)

## Введение[¶](#Введение)

_Samba_ это популярный пакет программ с открытыми исходными текстами, которая предоставляет файловые и принт-сервисы Microsoft(r) Windows(r) клиентам. При помощи пакета утилит [calculate-server](calculate-server.html) на samba сервере создаются пользователи, группы, ресурсы и происходит управление ими. В качестве Linux клиента может выступать [Calculate Linux Desktop](Calculate Linux Desktop.html) или любой _Gentoo_ дистрибутив с установленным пакетом _calculate-client_. В качестве Windows клиентов могут быть использованы операционные системы семейства Windows. Чтобы настроить сервер и клиент, воспользуйтесь статьей ["переход на использование Linux"]("переход на использование Linux".html). Для указания настраиваемого пакета программ в _calculate-server_ используется термин - сервис.

Сервис _samba_ используется для настройки _Samba_.

Сервис обязательно указывается для программ пакета _calculate-server_.  
Пример добавления пользователя _test_:  

    
    cl-useradd test samba
    

Для пользователя сервера права на файловые ресурсы одинаковы вне зависимости от клиента - Linux или Windows.

Пакет Samba включен в поставку [Calculate Directory Server](Calculate Directory Server.html). Если вы используете другую Gentoo систему, пакет можно установить из портежей, выполнив _emerge net-fs/samba_.

## Настройка сервера[¶](#Настройка-сервера)

Настройка сервера выполняется при помощи утилиты _calculate-server_. Для начала убедитесь что у вас [настроен LDAP сервер](настроен LDAP сервер.html) и выполнены [настройки Unix сервера](настройки Unix сервера.html).

Для настройки Samba-сервера выполните команду:  

    
    cl-setup [параметры] samba
    

В качестве параметров вы можете указать _netbios_ и _workgroup_.

* "-n name" - устанавливает имя NetBIOS, под которым будет работать Samba сервер. По умолчанию оно устанавливается равным первому компоненту DNS имени хоста.
* "-w workgroup" - имя домена или рабочей группы NT для компьютеров, которые будут получать доступ к этому серверу.

Если Samba сервер будет выступать в качестве _PDC (первичного контроллера Windows домена)_, вам следует задать пароль администратора сервера - пользователя с логином _admin_.  

    
    cl-passwd --smb admin  samba
    

Пользователь admin используется только для ввода клиентского windows компьютера в домен. Он не имеет домашней директории.

Если нужен администратор домена для управления windows компьютерами, добавьте нового пользователя который будет включен в доменную группу "Domain Admins", или включите в эту группу существующего пользователя.

Пример создания администратора домена:  

    
    cl-useradd -p --gid "Domain Admins" -c "Администратор домена" d_admin samba
    

Для [подключения unix клиентов](подключения unix клиентов.html), укажите пароль для служебного пользователя _client_.  

    
    cl-passwd --smb client samba
    

## Добавление и удаление пользователей[¶](#Добавление-и-удаление-пользователей)

Для работы с пользователями, используйте аналоги стандартных Unix команд: _cl-useradd, cl-userdel, cl-usermod, cl-passwd, cl-groupadd, cl-groupdel, cl-groupmod_. Синтаксис этих команд будет во многом совпадать с оригинальными.

Вместо _smbpasswd_, используйте _cl-passwd_ для изменения паролей пользователей, в т.ч. администратора Windows компьютеров.

Пример добавления пользователя test:  

    
    cl-useradd test samba
    

Пример изменения пароля пользователя test:  

    
    cl-passwd test samba
    

Пример добавления пользователя с первичной группой Domain Admins - администраторы домена  

    
    cl-useradd -g 'Domain Admins' test samba
    

Обратите внимание на опцию _samba_, добавляемую в конце команды.

## Настройка прав доступа[¶](#Настройка-прав-доступа)

### Настройка прав доступа к файловой системе[¶](#Настройка-прав-доступа-к-файловой-системе)

Для настройки прав доступа к файлам на сервере используйте ACL (Access Control List --- список контроля доступа). Изменяя права на файлы, вы ограничиваете к ним доступ в равной степени как для Windows, так и для Linux клиентов.

Права доступа применяются как к файлам, так и к директориям. Вы можете указать права доступа на владельца файла, либо на группу. Если Windows клиент будет распознавать только Samba группы, то в Linux будут отображаться имена Unix и Samba групп. Поэтому, для разграничения прав доступа, предпочтительней использовать Samba группы.

Для создания Samba группы "manager", выполните:  

    
    cl-groupadd manager samba
    

для создания Unix группы "job", выполните:  

    
    cl-groupadd job unix
    

Подробно настройка прав доступа с использованием ACL описана в статье ["Настройка прав доступа файловой системы"]("Настройка прав доступа файловой системы".html).

### Настройка прав доступа для пользователей Windows компьютеров[¶](#Настройка-прав-доступа-для-пользователей-Windows-компьютеров)

Настройка прав доступа к общим файлам сервера описана выше.

Для настройки дополнительных прав Windows машин, таких как: возможность устанавливать программы, возможность выхода из домена и т.д., используйте Samba группы.

Пример повышения прав пользователя test до администратора домена:  

    
    cl-groupmod -a test 'Domain Admins' samba
    

#### Структура Samba групп
Samba группы могут быть следующих типов:

* Доменные группы (номер типа группы 2)
* Локальные группы (номер типа группы 4)
* Встроенные группы (номер типа группы 5)

##### Группы созданные по умолчанию

**Доменные группы**
Доменные группы - глобальные группы которые действуют в домене.

* _Domain Admins_ - администраторы домена (полные права на компьютерах в домене).
* _Domain Guests_ - гости домена (минимальные права).
* _Domain Users_ - пользователи домена.
* _Domain Computers_ - компьютеры домена.

**Локальные группы**

Локальные группы - группы действующие локально на данном компьютере.  
Локальные группы отсутствуют.

**Встроенные группы**

_Встроенные группы_ - группы встроенные в систему.

* _Administrators_ - администраторы (полные права)
* _Account Operators_ - операторы учетных записей. Создание и управление пользовательской учетной информацией, создание и управление группами, резервное копирование файлов и каталогов.
* _Backup Operators_ - операторы архивов. Резервное копирование, восстановление из резервной копии, остановка системы. 
* _Print Operators_ - операторы печати. Управление принтерами, резервное копирование.
* _Replicators_ - репликаторы. Эта группа используется службой репликации File Replication на контроллерах домена.
* _System Operators_ - операторы системы. Изменение системного времени, останов системы, останов с удаленной системы, резервное копирование, восстановление из резервной копии, блокирование сервера, преодоление блокировки сервера, форматирование жесткого диска, управление сетевыми каталогами, управление принтерами.

#### Создание Samba группы

Создание доменной группы test. По умолчанию создается доменная группа, тип группы - 2\.  

    
    cl-groupadd test samba
    

Создание встроенной группы 'Power Users' - пользователи имеющие дополнительные права.   

    
    cl-groupadd -g 547 --rid 547 -t 5 'Power Users' samba
    

Где:

* _g_ - идентификатор группы 547 (Group ID)
* _rid_ - уникальный идентификатор 547 (RID)
* _t_ - тип группы 5 (встроенная группа)

## Просмотр информации[¶](#Просмотр-информации)

Для просмотра информации о пользователях и группах сервера воспользуемся командой _cl-info_:

Перечень пользователей unix cервиса:  

    
    cl-info -u unix
    

Перечень пользователей samba сервиса:  

    
    cl-info -u samba
    

Просмотр информации о пользователе unix сервиса:  

    
    cl-info -U <название пользователя> unix
    

Просмотр информации о пользователе samba сервиса:  

    
    cl-info -U <название пользователя> samba
    

Перечень существующих групп unix сервиса:  

    
    cl-info -g unix
    

Перечень существующих групп samba сервиса:  

    
    cl-info -g samba
    

Просмотр информации о группе unix сервиса:  

    
    cl-info -G <название группы> unix
    

Просмотр информации о группе samba сервиса:  

    
    cl-info -G <название группы> samba