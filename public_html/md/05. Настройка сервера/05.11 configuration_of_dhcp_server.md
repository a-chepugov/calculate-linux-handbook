# Настройка DHCP сервера[¶](#Настройка-DHCP-сервера)

## Установка DHCP сервиса в систему[¶](#Установка-DHCP-сервиса-в-систему)

Поддержка DHCP сервиса появилась в пакете [calculate-server](calculate-server.html) _2.1.4_.  
В качестве сервера используется dhcpd.

**Перед установкой**

Убедитесь что у вас поднят сетевой интерфейс, интерфейсу присвоен ip находящийся в сети которая будет указана при установке сервиса DHCP (параметр командной строки установки сервиса --net).

Убедитесь что у вас в системе установлен сервис dns, если он не был установлен, выполните установку командой:  

    
    cl-setup dns
    

Установка DHCP сервиса выполняется командой  

    
    cl-setup --router <ip шлюза> --dnames <имена доменов> --range <диапазон ip> --net <ip сети с маской /24> --dnsip <ip DNS сервера> dhcp
    

Параметры:

* --router - ip адрес передаваемый клиентскому компьютеру в качестве шлюза по умолчанию
* --dnames - доменные имена передаваемые клиентскому компьютеру в качестве доменых имен для поиска, разделитель имен запятая. Первое имя используется для создания DNS домена на серверном компьютере в который будут добавлены компьютеры подключающиеся к сети.
* --range - диапазон адресов из которого клиентский компьютер получает свой ip, два ip адреса разделенные запятой.
* --net - cеть в которой будут находиться клиентские компьютеры
* --dnsip - ip адрес DNS сервера передаваемый клиентскому компьютеру

Примечание: для того чтобы клиентские компьютеры находили себя в DNS, параметр --dnsip должен указывать на текущий сервер с устанавливаемым сервисом DHCP

Пример (текущий сервер где устанавливаем DHCP сервис имеет ip 10.0.0.5):  

    
    cl-setup --router 10.0.0.1 --dnames domain.ru,domain.org --range 10.0.0.20,10.0.0.100 --net 10.0.0.0/24 --dnsip 10.0.0.5 dhcp
    

ВAЖНО: При установке сервиса DHCP изменяется доменное имя сервера на имя\_хоста.первое\_доменное\_имя\_для\_поиска, если уже были настроены сервисы "FTP","SAMBA","MAIL", "PROXY", "JABBER" то необходимо первым доменным именем для поиска указать текущий домен, параметр "--dnames текущий\_домен" (для его получения выполните команду hostname -d перед установкой сервиса). Второй вариант: необходимо в DNS прописать предыдущее полное имя сервера указывающее на его ip адрес)

## Управление DHCP сервисом[¶](#Управление-DHCP-сервисом)

### Управление статическими хостами DHCP сервиса[¶](#Управление-статическими-хостами-DHCP-сервиса)

#### Создание статического хоста DHCP

Для создания статического используется команда  

    
    cl-dhcp-hostadd --host <название хоста> --ip <ip адрес> --mac <mac адрес>
    

Параметры:

* --host - название клиентского компьютера, (название без домена)
* --ip - ip адрес который будет назначен клиентскому компьютеру
* --mac - mac адрес клиентского компьютера (можно узнать командой ifconfig)

Пример:  

    
    cl-dhcp-hostadd --host test --ip 10.0.0.20 --mac 00:17:31:c2:88:82
    

#### Модификация параметров статического хоста

Для модификации статического хоста используется команда  

    
    cl-dhcp-hostmod [параметры] название_хоста
    

Параметры:

* --ip - измененный ip адрес который будет назначен клиентскому компьютеру
* --mac - изменненный mac адрес клиентского компьютера

Пример:  

    
    cl-dhcp-hostmod --ip 10.0.0.25 test
    

#### Удаление статического хоста

Для удаления статического хоста используется команда  

    
    cl-dhcp-hostdel --host <название хоста>
    

Параметры:

* --host - название клиентского компьютера, (название без домена)

Пример:  

    
    cl-dhcp-hostdel --host test
    

### Управление сетями DHCP сервиса[¶](#Управление-сетями-DHCP-сервиса)

#### Создание сети DHCP

_На каждый сетевой интерфейс может быть создана только одна сеть._

Для создания сети используется команда  

    
    cl-dhcp-netadd --router <ip роутера> --dnames <имена доменов> --range <диапазон ip для динамических хостов> --net <ip сети с маской /24> --dnsip <ip DNS сервера> dhcp
    

Параметры:

* --router - ip адрес передаваемый клиентскому компьютеру в качестве шлюза по умолчанию
* --dnames - доменные имена передаваемые клиентскому компьютеру в качестве доменых имен для поиска, разделитель имен запятая. Первое имя используется для создания DNS домена на серверном компьютере в который будут добавлены компьютеры подключающиеся к сети.
* --range - диапазон адресов из которого клиентский компьютер получает свой ip, два ip адреса разделенные запятой.
* --net - cеть в которой будут находится клиентские компьютеры
* --dnsip - ip адрес DNS сервера передаваемый клиентскому компьютеру

Пример:  

    
    cl-dhcp-netadd --router 10.0.0.1 --dnames domain.ru,domain.org --range 10.0.0.20,10.0.0.100 --net 10.0.0.0/24 --dnsip 10.0.0.5
    

#### Модификация параметров сети DHCP

Для модификации параметров сети используется команда  

    
    cl-dhcp-netmod  [параметры] ip_и_маска_сети
    

Параметры:

* --router - измененный ip адрес передаваемый клиентскому компьютеру в качестве шлюза по умолчанию.
* --dnames - измененные доменные имена передаваемые клиентскому компьютеру в качестве доменых имен для поиска, разделитель имен запятая. Первое имя используется для создания DNS домена на серверном компьютере в который будут добавлены компьютеры подключающиеся к сети.
* --range - измененный диапазон динамических адресов которые раздаются клиентским компьютерам.
* --dnsip - измененный ip адрес DNS сервера передаваемый клиентскому компьютеру

Пример:  

    
    cl-dhcp-netmod --range 10.0.0.50,10.0.0.255 10.0.0.0/24
    cl-dhcp-netmod --router 10.0.0.1 10.0.0.0/24
    

#### Удаление cети DHCP

_Если существует только одна сеть DHCP то ее удаление приведет к невозможности запуска DHCP сервера добавление новой сети вернет работоспособность._

Для удаления сети используется команда  

    
    cl-dhcp-netdel --net ip_и_маска_сети
    

Параметры:

* --net удаляемая сеть

Пример:  

    
    cl-dhcp-netdel --net 10.0.0.0/24
    

## Информация о DHCP сервисе[¶](#Информация-о-DHCP-сервисе)

Для получения информации о записях и зонах DNS сервиса используется команда _cl-info_.

### Информация о всех сетях[¶](#Информация-о-всех-сетях)

    
    cl-info -n dhcp
    

### Информация о cети[¶](#Информация-о-cети)

    
    cl-info -N <ip_и_маска_сети> dhcp
    

Пример.  

    
    cl-info -N 10.0.0.0/24 dhcp
    

Информация о сети 10.0.0.0/24

### Информация о всех статических хостах==[¶](#Информация-о-всех-статических-хостах)

    
    cl-info --hosts dhcp
    

### Информация о статическом хосте[¶](#Информация-о-статическом-хосте)

    
    cl-info -H <название хоста> dhcp
    

Пример.  

    
    cl-info -H computer dhcp
    

  
Информация о статическом хосте computer.