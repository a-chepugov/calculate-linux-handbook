<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title>encrypt home directory</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<style>
body { font:80% Verdana,Tahoma,Arial,sans-serif; }
h1, h2, h3, h4 {  font-family: "Trebuchet MS",Georgia,"Times New Roman",serif; }
ul.toc { padding: 4px; margin-left: 0; }
ul.toc li { list-style-type:none; }
ul.toc li.heading2 { margin-left: 1em; }
ul.toc li.heading3 { margin-left: 2em; }
a.wiki-anchor { display: none; margin-left: 6px; text-decoration: none; }
a.wiki-anchor:hover { color: #aaa !important; text-decoration: none; }
h1:hover a.wiki-anchor, h2:hover a.wiki-anchor, h3:hover a.wiki-anchor { display: inline; color: #ddd; }
pre {font-size:133% }
</style>
</head>
<body>
<h1 id="Шифрование-домашних-директорий">Шифрование домашних директорий<a href="#Шифрование-домашних-директорий" class="wiki-anchor">&para;</a></h1>


	<ul class="toc right"><li class="heading1"><a href="#Шифрование-домашних-директорий">Шифрование домашних директорий</a></li>
<li class="heading2"><a href="#Принцип-работы">Принцип работы</a></li>
<li class="heading2"><a href="#Настройка-профиля-на-шифрование">Настройка профиля на шифрование</a></li>
<li class="heading2"><a href="#Как-восстановить-данные">Как восстановить данные</a></li>
</ul>


	<p>Начиная с версии 13.6 в Calculate Linux появилась возможность использовать шифрованные домашние директории. Для организации защиты персональных данных используется eCryptfs - файловая система, работающая «поверх» любой другой обычной ФС и прозрачно шифрующая/дешифрующая содержимое файлов. Криптографические метаданные eCryptfs хранит в заголовках каждого файла, таким образом, можно без проблем переносить любой файл между различными системами. Всё это реализовано на уровне ядра Linux, обеспечивая хороший уровень производительности по сравнению с FUSE-шифрованием.</p>


	<h2 id="Принцип-работы">Принцип работы<a href="#Принцип-работы" class="wiki-anchor">&para;</a></h2>


	<p>Домашняя папка пользователя с профилем, настроенным на шифрование, содержит только символические ссылки на директории с шифрованными данными. Шифрованные данные пользователей хранятся в каталоге <code>/home/.ecryptfs</code> и разделены по пользователям, при этом в папке <code>.Private</code> хранятся данные, в <code>.ecryptfs</code> - информация по подключению шифрования.</p>


	<p>При входе в сеанс <code>/home/.ecryptfs/имя_пользователя/.Private</code> монтируется в домашнюю директорию. Для этого используется зашифрованный пользовательским паролем ключ: <code>/home/.ecryptfs/имя_пользователя/.ecryptfs/wrapped-passphrase</code>. Дальше происходят синхронизация профиля пользователя и настройка его при необходимости.</p>


	<p>При выходе из сеанса домашняя директория отключается от <code>.Private</code>.</p>


	<p>Данные доменных пользователей также могут быть настроены на шифрование, при этом нужно отметить, что в шифрованном виде эти данные будут находиться на локальной машине, на сервере они находятся в незашифрованном виде. Таким образом обеспечивается безопасность данных, оставленных в пользовательском профиле после выхода из сеанса.</p>


	<h2 id="Настройка-профиля-на-шифрование">Настройка профиля на шифрование<a href="#Настройка-профиля-на-шифрование" class="wiki-anchor">&para;</a></h2>


	<p>Для того, чтобы активировать данную функцию, систему нужно установить с включенным параметром "Шифровать пользовательские профили" (<em>Crypt user profiles</em>), либо включить переменную <code>main.cl_home_crypt_set</code> в уже установленной системе.</p>


<pre>
cl-core-variables --set main.cl_home_crypt_set=on
</pre>

	<p>Шифрование будет настроено только для новых пользователей (тех, у которых нет домашней директории). Включить шифрование для существующего профиля можно при помощи команды <code>ecryptfs-migrate-home</code>.</p>


<pre>
ecryptfs-migrate-home -u &lt;имя_пользователя&gt;
</pre>Команда запросит пароль пользователя.

	<p>Для  доменных пользователей будет достаточно удалить локальный профиль, когда он не в сеансе, и после этого войти в сеанс.</p>


	<p>Стоит отметить, что на настроенный пользовательский профиль значение переменной <code>cl_home_crypt_set</code> не влияет, то есть если профиль был настроен на шифрование, а система была установлена без шифрования, профиль будет продолжать работать с шифрованием, и наоборот.</p>


	<h2 id="Как-восстановить-данные">Как восстановить данные<a href="#Как-восстановить-данные" class="wiki-anchor">&para;</a></h2>


	<p>Если в <code>/home</code> остался только каталог <code>.ecryptfs</code>, содержащий шифрованные профили, то достаточно создать таких же пользователей с теми же паролями, и при входе в сеанс домашний каталог пользователя будет использоваться существующий шифрованный профиль.</p>
</body>
</html>
