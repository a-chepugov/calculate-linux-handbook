<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title>calculate core</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<style>
body { font:80% Verdana,Tahoma,Arial,sans-serif; }
h1, h2, h3, h4 {  font-family: "Trebuchet MS",Georgia,"Times New Roman",serif; }
ul.toc { padding: 4px; margin-left: 0; }
ul.toc li { list-style-type:none; }
ul.toc li.heading2 { margin-left: 1em; }
ul.toc li.heading3 { margin-left: 2em; }
a.wiki-anchor { display: none; margin-left: 6px; text-decoration: none; }
a.wiki-anchor:hover { color: #aaa !important; text-decoration: none; }
h1:hover a.wiki-anchor, h2:hover a.wiki-anchor, h3:hover a.wiki-anchor { display: inline; color: #ddd; }
pre {font-size:133% }
</style>
</head>
<body>
<h1 id="Сервер-утилит-Calculate">Сервер утилит Calculate<a href="#Сервер-утилит-Calculate" class="wiki-anchor">&para;</a></h1>


	<ul class="toc"><li class="heading1"><a href="#Сервер-утилит-Calculate">Сервер утилит Calculate</a></li>
<li class="heading2"><a href="#Введение">Введение</a></li>
<li class="heading2"><a href="#Начало-работы-создание-сертификата">Начало работы, создание сертификата</a></li>
<li class="heading3"><a href="#Подписание-сертификата-у-другого-сервера-утилит">Подписание сертификата у другого сервера утилит</a></li>
<li class="heading3"><a href="#Создание-самоподписного-сертификата">Создание самоподписного сертификата</a></li>
<li class="heading3"><a href="#Запуск-сервера-утилит">Запуск сервера утилит</a></li>
<li class="heading2"><a href="#Действия-с-сервером-утилит">Действия с сервером утилит</a></li>
<li class="heading3"><a href="#Операции-с-запросами-и-сертификатами">Операции с запросами и сертификатами</a></li>
<li class="heading3"><a href="#Локальный-запуск-процессов">Локальный запуск процессов</a></li>
<li class="heading3"><a href="#Другие-действия">Другие действия</a></li>
<li class="heading2"><a href="#Стандартные-методы-сервера-утилит">Стандартные методы сервера утилит</a></li>
</ul>


	<h2 id="Введение">Введение<a href="#Введение" class="wiki-anchor">&para;</a></h2>


	<p>Сервер утилит Calculate Core служит для выполнения методов утилит, таких как установка, настройка системы и т.д. и для осуществления сетевого доступа клиентам (<a href="cl-console.html" class="wiki-page">cl-console</a> и <a href="cl-console-gui.html" class="wiki-page">cl-console-gui</a>) по протоколу <noindex><a href="http://ru.wikipedia.org/wiki/HTTPS" rel="nofollow" target="_blank" class="external">https</a></noindex> к функциям утилит Calculate. Calculate Core входит в состав утилит Calculate 3. Установить сервер утилит можно при помощи пакета <code>sys-apps/calculate-core</code>.</p>


	<h2 id="Начало-работы-создание-сертификата">Начало работы, создание сертификата<a href="#Начало-работы-создание-сертификата" class="wiki-anchor">&para;</a></h2>


Для запуска сервера утилит необходимо создать сертификат одним из двух способов: 
	<ul>
	<li>создать запрос на подписание сертификата (далее запрос) и подписать сертификат у другого сервера;</li>
		<li>создать самоподписной корневой сертификат и использовать его в качестве сертификата сервера.</li>
	</ul>


	<p>Для запуска сервера утилит необходим серверный сертификат. Корневой самоподписной сертификат необходим для подписания сертификатов другим серверам утилит.</p>


	<h3 id="Подписание-сертификата-у-другого-сервера-утилит">Подписание сертификата у другого сервера утилит<a href="#Подписание-сертификата-у-другого-сервера-утилит" class="wiki-anchor">&para;</a></h3>


	<p>Для генерации секретного ключа и запроса, а так же для отправки запроса на сервер утилит используйте команду<br /><pre>
cl-core --gen-cert-by HOST --port PORT
</pre>, где HOST - сетевой адрес сервера утилит, PORT - порт, который прослушивает сервер утилит (по умолчанию 8888)<br />Например,<br /><pre>
cl-core --gen-cert-by 192.168.0.123 --port 4567
</pre></p>


	<p>После подписания сертификата на сервере утилит необходимо забрать его с помощью команды<br /><pre>
cl-core --get-cert-from ROOT_HOST --port PORT
</pre>, где ROOT_HOST - сетевой адрес сервера утилит, PORT - порт, который прослушивает сервер утилит (по умолчанию 8888)</p>


	<p>Например,<br /><pre>
cl-core --get-cert-from 192.168.0.123 --port 4567
</pre></p>


	<h3 id="Создание-самоподписного-сертификата">Создание самоподписного сертификата<a href="#Создание-самоподписного-сертификата" class="wiki-anchor">&para;</a></h3>


	<p>Для создания самоподписного корневого сертификата используйте команду<br /><pre>
cl-core --gen-root-cert
</pre></p>


	<p>Для использования созданного самоподписного корневого сертификата как сертификат сервера утилит используйте команду<br /><pre>
cl-core --use-root-as-server
</pre></p>


	<h3 id="Запуск-сервера-утилит">Запуск сервера утилит<a href="#Запуск-сервера-утилит" class="wiki-anchor">&para;</a></h3>


	<p>После генерации сертификата сервер утилит можно запустить с помощью команды<br /><pre>
cl-core --start
</pre></p>


	<p>При этом сервер утилит будет прослушивать порт 8888, для указания порта используйте ключ --port, например<br /><pre>
cl-core --start --port 5648
</pre></p>


	<p>Для запуска в режиме отладки (debug), используйте ключ --debug</p>


	<h2 id="Действия-с-сервером-утилит">Действия с сервером утилит<a href="#Действия-с-сервером-утилит" class="wiki-anchor">&para;</a></h2>


	<h3 id="Операции-с-запросами-и-сертификатами">Операции с запросами и сертификатами<a href="#Операции-с-запросами-и-сертификатами" class="wiki-anchor">&para;</a></h3>


	<h4>Просмотр запросов и сертификатов</h4>


	<p>Многие действия с сервером утилит можно выполнять непосредственно на сервере, без использования клиентов. Для этого необходимы права суперпользователя - root.</p>


	<p>Для просмотра клиентских запросов используйте ключ --show-request с указанием номера запроса или слова "all" для просмотра списка запросов, например<br /><pre>
cl-core --show-request all
cl-core --show-request 2
</pre></p>


	<p>Для просмотра клиентских подписанных сертификатов используйте ключ --cert с указанием номера сертификата или слова "all" для просмотра списка сертификатов, например<br /><pre>
cl-core --cert all
cl-core --cert 2
</pre></p>


	<p>С помощью ключа --dump можно просмотреть сразу все сертификаты<br /><pre>
cl-core --cert all --dump
</pre><br />или содержимое файла сертификата, например<br /><pre>
cl-core --cert 4 --dump
</pre></p>


	<p>Для просмотра запросов и сертификатов серверов утилит используйте ключ --server-cert с указанием номера или "all", например<br /><pre>
cl-core --server-cert all
cl-core --server-cert 2
</pre></p>


	<h4>Подписание запросов и отзыв сертификатов клиента</h4>


	<p>Для подписание клиентского запроса на подпись сертификата используйте ключ --sign-client с указанием номера запроса, например<br /><pre>
cl-core --sign-client 4
</pre><br />После этого введите группу прав для нового сертификата (изменить её в дальнейшем невозможно). Подписание осуществляется серверным сертификатом.</p>


	<p>Если необходимо отвергнуть клиентский запрос, используйте ключ --del-client-req с указанием номера запроса, например<br /><pre>
cl-core --del-client-req 4
</pre></p>


	<p>Для удаления уже подписанного сертификата клиента совместно с ключом --cert и указанием номера сертификата используйте ключ --remove, например<br /><pre>
cl-core --cert 4 --remove
</pre></p>


	<p>Также создать сертификат пользователь с правами группы "all" можно с помощью команды<br /><pre>
cl-core --bootstrap username
</pre><br />например, с помощью команды<br /><pre>
cl-core --bootstrap iivanov
</pre><br />для пользователя iivanov будет создан сертификат с правами группы "all" и добавлен в доверенные сертификат сервера утилит.</p>


	<p>Для удаления всех сертификатов, запросов и конфигурационных файлов на сервере совместно с ключом --bootstrap используйте ключ --remove-certs, например:<br /><pre>
cl-core --bootstrap iivanov --remove-certs
</pre></p>


	<h4>Подписание запросов и отзыв сертификатов сервера утилит</h4>


	<p>Для подписание запроса на подпись сертификата от другого сервера утилит используйте ключ --sign-server с указанием номера запроса, например<br /><pre>
cl-core --sign-server 4
</pre><br />Подписание осуществляется корневым сертификатом.</p>


	<p>Если необходимо отвергнуть запрос сервера утилит, используйте ключ --del-server-req с указанием номера запроса, например<br /><pre>
cl-core --del-server-req 4
</pre></p>


	<p>Для отзыва подписанного сертификата сервера утилит (добавление в список отзыва) используйте ключ --revoke-cert с указанием номера сертификата, например<br /><pre>
cl-core --revoke-cert 4
</pre><br />Для удаления списка отзывов сертификатов, используйте команду<br /><pre>
cl-core --revoke-cert rm
</pre></p>


	<h4>Изменение прав сертификатов</h4>


	<p>Права для групп сертификатов по умолчанию хранятся в файле <code>/var/calculate/server/conf/group_right.conf</code> в следующем виде: <span class="bluecode" >group right1[, right2[,right3...]]</span>, например<br /><pre>
manager install, get-sessions, request
user get-sessions,request,view_cert
</pre></p>


	<p>Для изменения прав конкретного сертификата используется файл <code>/var/calculate/server/conf/right.conf</code>, куда необходимо вписать права и номера сертификатов, например<br /><pre>
install 1 2 -3
</pre><br />для сертификатов с номерами 1 и 2 добавить право на действие install и удалить его для сертификата с номером 3.<br />Права для конкретного сертификата имеют приоритет перед правами для группы сертификата.</p>


	<p>Для изменения прав конкретного сертификата клиента используется ключи --right-add и --right-del совместно с ключом --cert, например<br /><pre>
cl-core -c 6 --right-del install_pxe,install
cl-core -c 7 --right-add install_pxe,install,configure_video
</pre><br />В примере для сертификата с номером 6 установится запрет на методы, требующие права install_pxe и install, а для сертификата с номером 7 установится разрешение на методы install_pxe, install и configure_video.</p>


	<h3 id="Локальный-запуск-процессов">Локальный запуск процессов<a href="#Локальный-запуск-процессов" class="wiki-anchor">&para;</a></h3>


	<h4>Запуск методов с помощью ключа --method</h4>


	<p>Все действия на сервере утилит можно запускать как через клиентов (<a href="cl-console-gui.html" class="wiki-page">cl-console-gui</a>, <a href="cl-console.html" class="wiki-page">cl-console</a>), с использованием шифрования по сертификатам и позволяющим выполнять действия на удалённых серверах утилит, так и с помощью самих серверов утилит, выполняющих действия напрямую и только на локальных серверах утилит.</p>


	<p>Для просмотра всех доступных действий на сервере утилит используйте команду<br /><pre>
# cl-core --list-methods

install  -  Установка системы
setup_boot  -  Загрузка
core_setup  -  Настройка пакета
...
</pre></p>


	<p>Для запуска метода используйте команду<br /><pre>
cl-core --method METHOD
</pre><br />например:<br /><pre>
cl-core --method install --iso /path_to_image/cld-x86_64.iso -d /dev/sda1:swap -d /dev/sda2:/:ext4:on
</pre></p>


	<p>Для просмотра справки действия используйте команду<br /><pre>
cl-core --method METHOD --help
</pre><br />например:<br /><pre>
cl-core --method install --help
</pre></p>


	<p>Ключ -f, --force устанавливает режим, при котором пользователю не задаются вопросы и не отображаются предварительные параметры (brief).</p>


	<p>Ключ --no-progress отключает отображение прогрессбаров (текущего прогресса выполнения задачи).</p>


	<h4>Ссылки на методы</h4>


	<p>При установке системы для всех действий на сервере утилит создаются символические ссылки вида cl-method, где method - название метода, которое можно получить с помощью cl-core --list-methods. Например, для метода setup_network ссылкой будет команда cl-setup-network (символы "_" заменяются на "&#x2010;").</p>


	<p>Для создания отсутствующих ссылок и удаления ссылок на отсутствующие действия сервера утилит используйте команду<br /><pre>
cl-core --create-symlink
</pre></p>


	<p>Выполнять команду cl-core и все символические ссылки на неё может только пользователь root.<br />Все символические ссылки работают по принципу вызова метода сервера утилит - только на локальной машине без использования сертификатов и шифрования.</p>


	<h3 id="Другие-действия">Другие действия<a href="#Другие-действия" class="wiki-anchor">&para;</a></h3>


	<p>Проверить конфигурацию (наличие сертификата и секретного ключа, их соответствие друг другу, а так же действителен ли сертификат) можно с помощью ключа --check</p>


	<p>Указать путь к для ведения журнал событий (логов) можно с помощью ключа --log-path, например:<br /><pre>
cl-core --log-path /var/log/calculate/mylogs/
</pre></p>


	<p>Файл логов по умолчанию - /var/log/calculate/logging_cl_core.out.</p>


	<p>Указание пути к PID файлу осуществляется с помощью ключа --pid-file PIDFILE</p>


Дополнительно есть две опции для отображения прогресса выполнения в GUI:
	<ul>
	<li><em>--gui-progress</em> - отображает индикатор прогресса в GUI</li>
		<li><em>--gui-warning</em> - отображает предупреждения в конце</li>
	</ul>


	<p>Передача пароля со стандартного ввода осуществляется с помощью ключа -P, например:</p>


<pre>
cat pass | cl-core -P --method install -u test -f
</pre>

	<p>Опция -P должна использоваться вместе с опцией -f, т.к. при перенаправлении потоков ввода/вывода использование интерактивного режима невозможно.</p>


	<h2 id="Стандартные-методы-сервера-утилит">Стандартные методы сервера утилит<a href="#Стандартные-методы-сервера-утилит" class="wiki-anchor">&para;</a></h2>


	<p>Все методы сервера утилит разделены на категории. В версии сервера утилит 3.2.0 существуют следующие стандартные категории: Клиент, Настройка, Обновить, Рабочий стол, Установка и Утилиты.</p>


	<h4>Клиент</h4>


	<p>Категория Клиент включает в себя методы для изменения поведения системы(локальная/доменная) и для смены паролей пользователей.</p>


	<h4>Настройка</h4>


	<p>Категория Настройка включает в себя методы для настройки параметров системы и пакетов.</p>


	<h4>Обновить</h4>


	<p>Категория Обновить включает в себя методы для обновления системы, настроек и смены профиля.</p>


	<h4>Рабочий стол</h4>


	<p>Категория Рабочий стол включает в себя методы для принудительного выхода пользователей из сеанса и настройки профилей пользователей.</p>


	<h4>Установка</h4>


	<p>Категория Установка включает в себя методы для установки системы.</p>


	<h4>Утилиты</h4>


	<p>Категория Утилиты включает в себя методы для работы с сертификатами, запросами и группами прав сертификатов.</p>
</body>
</html>
