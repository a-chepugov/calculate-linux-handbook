<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title>eclean</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<style>
body { font:80% Verdana,Tahoma,Arial,sans-serif; }
h1, h2, h3, h4 {  font-family: "Trebuchet MS",Georgia,"Times New Roman",serif; }
ul.toc { padding: 4px; margin-left: 0; }
ul.toc li { list-style-type:none; }
ul.toc li.heading2 { margin-left: 1em; }
ul.toc li.heading3 { margin-left: 2em; }
a.wiki-anchor { display: none; margin-left: 6px; text-decoration: none; }
a.wiki-anchor:hover { color: #aaa !important; text-decoration: none; }
h1:hover a.wiki-anchor, h2:hover a.wiki-anchor, h3:hover a.wiki-anchor { display: inline; color: #ddd; }
pre {font-size:133% }
</style>
</head>
<body>
<h1 id="eclean">eclean<a href="#eclean" class="wiki-anchor">&para;</a></h1>


	<h2 id="НАЗВАНИЕ">НАЗВАНИЕ<a href="#НАЗВАНИЕ" class="wiki-anchor">&para;</a></h2>


eclean - утилита для удаления ненужных файлов исходного кода и бинарных пакетов Gentoo 

	<h2 id="СИНТАКСИС">СИНТАКСИС<a href="#СИНТАКСИС" class="wiki-anchor">&para;</a></h2>


	<p><strong>eclean </strong>[<em>глобальные опции</em>] ... &lt;<em>действия</em>&gt; [<em>опции действий</em>] ...</p>


	<p><strong>eclean-dist </strong>[<em>глобальные опции, опции файлов исходного кода</em>] ...</p>


	<p><strong>eclean-pkg </strong>[<em>глобальные опции, опции пакетов</em>] ...</p>


	<p><strong>eclean(-dist,-pkg) </strong>[<em>--help, --version</em>]</p>


	<h2 id="ОПИСАНИЕ">ОПИСАНИЕ<a href="#ОПИСАНИЕ" class="wiki-anchor">&para;</a></h2>


	<p><strong>eclean</strong> - это небольшая утилита, предназначенная для удаления устаревших исходных кодов и бинарных пакетов portage. При регулярном использовании она предотвращает разрастание каталогов DISTDIR и PKGDIR, хотя в отдельных случаях сохранение данных может быть полезно.</p>


	<p>По умолчанию eclean препятствует удалению всех файлов исходного кода и бинарных пакетов, соответствующих некоторым ебилдам, доступным в дереве портежей. Это наиболее безопасный режим работы, поскольку он обеспечивает сохранение тех данных, которые еще могут быть полезны - например, для того, чтобы откатиться на более раннюю версию пакета без повторной загрузки исходного кода или чтобы переустановить пакет, который вы ошибочно удалили, без его перекомпиляции. Но очевидно и то, что в этом случае размер каталогов DISTDIR и PKGDIR будет довольно большим (хотя они не будут увеличиваться бесконечно). Кроме того, в этом режиме утилита медленно работает с файлами исходного кода, так как требует доступа ко всему дереву портежей.</p>


Если вы используете опцию --destructive, eclean будет сохранять лишь те файлы, которые соответствуют тому или иному пакету, устанавливаемому в данный момент (исходя из точной версии пакета). Эта опция позволяет высвободить гораздо большее пространство; при этом сохраняются файлы исходных кодов для несущественных ревизий и бинарные файлы для переустановки поврежденных пакетов. Но для менее распространенных операций - например, для отката версии или переустановки удаленного пакета - данные будут удалены. Это самый быстрый режим (что очень заметно при обработке файлов исходного кода). Он используется многими сценариями очистки - в качестве примера можно привести yacleaner (по крайней мере в версии 0.3).

Компромиссным вариантом можно считать использование опции --package-names в связке с  --destructive - это предотвратит удаление файлов, соответствующих всем существующим версиям установленных пакетов. В результате при необходимости можно будет легко откатиться на более раннюю версию, не пересобирая пакет и не загружая данные заново, но удалению пакетов это не помешает.

	<p>В дополнение к перечисленным основным режимам доступны несколько других опций, позволяющих объявлять особые правила защиты файлов от удаления:</p>


	<p>o</p>


	<p style="padding-left:4em;">опция --time-limit удобна для защиты от удаления файлов, которые были созданы ранее заданного времени.</p>


	<p>o</p>


	<p style="padding-left:4em;">опция --size-limit (только для файлов исходного кода) удобна для защиты от удаления файлов, размер которых превышает заданный.</p>


	<p>o</p>


	<p style="padding-left:4em;">опция --fetch-restricted (только для файлов исходного кода) удобна для защиты от удаления файлов, загруженных вручную. Однако ее использование влечет за собой замедление работы утилиты (по причине, описанной выше: считывание всех данных из дерева портежей).</p>


	<p>o</p>


	<p style="padding-left:4em;">Наконец, вы можете включить отдельные пакеты или категории пакетов в список исключаемых (см. ниже раздел <strong>ИСКЛЮЧАЕМЫЕ ФАЙЛЫ</strong>).</p>


	<h2 id="ПАРАМЕТРЫ">ПАРАМЕТРЫ<a href="#ПАРАМЕТРЫ" class="wiki-anchor">&para;</a></h2>


	<h3 id="-Глобальные-опции"> Глобальные опции<a href="#-Глобальные-опции" class="wiki-anchor">&para;</a></h3>


	<p><strong>-C, --nocolor</strong><br />Отключить цветной вывод</p>


	<p><strong>-d, --destructive</strong><br />Сохранить только минимум данных для переустановки</p>


	<p><strong>-e, --exclude-file=&lt;путь&gt;</strong><br />Назначить путь доступа к файлу исключений</p>


	<p style="padding-left:4em;"><strong>&lt;путь&gt;</strong> <br />Абсолютный путь к файлу исключений, который вы хотите использовать. Если эта опция не используется, путями по умолчанию будут соответственно /etc/eclean/{packages,distfiles}.exclude (если они существуют). Используйте /dev/null, если этот данный файл у вас имеет стандартное расположение, но вы хотите временно его игнорировать.</p>


	<p><strong>-i, --interactive</strong><br />Требовать подтверждения, прежде чем удалить</p>


	<p><strong>-n, --package-names</strong>
Защищать от удаления все версии (только для опции --destructive)</p>


	<p><strong>-p, --pretend</strong><br />Не выполнять действий над данными, а лишь показывать, что именно будет удалено</p>


	<p><strong>-q, --quiet</strong><br />Использовать компактный вывод: сообщать только об ошибках</p>


	<p><strong>-t, --time-limit=&lt;время&gt;</strong><br />Не удалять файлы, которые изменялись в указанное &lt;время&gt;</p>


	<p style="padding-left:4em;"><strong>&lt;время&gt;</strong> - это определенный промежуток времени: 1y обозначает один год, 2w - две недели, и так далее. <br />Допустимые единицы измерения: y (год), m (месяц), w (неделя), d (день), h (час).</p>


	<p><strong>-h, --help</strong><br />Вывести справку по утилите</p>


	<p><strong>-v, --verbose</strong><br />Использовать подробный вывод служебных сообщений в ходе работы утилиты</p>


	<p><strong>-V, --version</strong><br />Вывести информацию о версии</p>


	<h3 id="-Действия"> Действия<a href="#-Действия" class="wiki-anchor">&para;</a></h3>


	<p><strong>distfiles</strong></p>


	<p style="padding-left:4em;">Удалить файлы из каталога /usr/portage/distfiles (или по другому пути, определенному в переменной DISTDIR в вашем файле /etc/make.conf). Это потребуется практически любому пользователю Gentoo, ведь каталог DISTDIR может достигать весьма больших размеров.<br /><strong>eclean-dist</strong> представляет собой алиас eclean с действием distfiles, для упрощения вызова из командной строки.</p>


	<p><strong>packages</strong></p>


	<p style="padding-left:4em;">Удалить файлы из каталога /usr/portage/packages (или по другому пути, определенному в переменной PKGDIR в вашем файле /etc/make.conf). Это имеет смысл, в частности, если у вас выставлены флаги FEATURES buildpkg или buildsyspkg.<br /><strong>eclean-pkg</strong> представляет собой алиас eclean с действием packages, для упрощения вызова из командной строки.</p>


	<h3 id="-Опции-для-действия-distfiles"> Опции для действия distfiles<a href="#-Опции-для-действия-distfiles" class="wiki-anchor">&para;</a></h3>


	<p><strong>-f, --fetch-restricted</strong>
предотвращать удаление загруженных вручную файлов (только с опцией --destructive)</p>


	<p><strong>-s, --size-limit=&lt;размер&gt;</strong><br />не удалять файлы исходного кода, размер которых превышает заданный &lt;размер&gt;</p>


	<p style="padding-left:4em;">&lt;размер&gt; - это размер файла: запись 10M означает 10 мегабайт, 200K - 200 килобайт, и так далее. <br />Допустимые единицы измерения - G (гигабайт), M (мегабайт), K (килобайт) и B (байт).</p>


	<h3 id="Опции-для-действия-packages">Опции для действия packages<a href="#Опции-для-действия-packages" class="wiki-anchor">&para;</a></h3>


	<p>Отдельных опция для данного действия нет.</p>


	<h2 id="ИСКЛЮЧАЕМЫЕ-ФАЙЛЫ">ИСКЛЮЧАЕМЫЕ ФАЙЛЫ<a href="#ИСКЛЮЧАЕМЫЕ-ФАЙЛЫ" class="wiki-anchor">&para;</a></h2>


	<p>Исключаемые файлы представляют собой перечни отдельных пакетов или категорий пакетов, которые вы хотите защитить от удаления. Это имеет смысл, если вам необходимо, например, сохранить собранные системные пакеты. При этом используется следующий синтаксис:</p>


	<p>o</p>


	<p style="padding-left:4em;">Пустые строки и строки, начинающиеся с символа "#" (строки комментариев) игнорируются.</p>


	<p>o</p>


	<p style="padding-left:4em;">Допускается только одна запись в строке.</p>


	<p>o</p>


	<p style="padding-left:4em;">Если строка содержит имя категории, например, sys-apps, ни один пакет из данной категории не будет удален. Запись sys-apps/* также допускается, поскольку она более наглядна, но это НЕ ОЗНАЧАЕТ, что подстановочные символы поддерживаются в каких-либо других целях.</p>


	<p>o</p>


	<p style="padding-left:4em;">Если строка содержит название пакета (например, app-shells/bash), данный пакет удаляться не будет. Указание атомов с версией, например, >=app-shells/bash-3, НЕ ПОДДЕРЖИВАЕТСЯ. Кроме того, обязательно указывать полное имя пакета (с категорией).</p>


	<p>o</p>


	<p style="padding-left:4em;">Если строка содержит имя пакета с восклицательным знаком впереди (например, !sys-apps/portage), данный пакет будет исключен из числа защищенных от удаления. Это имеет смысл только в том случае, если от удаления защищена категория, к которой он относится.</p>


	<p>o</p>


	<p style="padding-left:4em;">При защите файлов исходного кода, строка может содержать и имя файла. Это имеет смысл в том случае, если у вас имеются файлы, не фигурирующие в ебилдах - например, файлы локализации OpenOffice.org i18n (скажем, helpcontent_33_unix.tgz). Другим примером ситуации, в которой следует использовать такой синтаксис, может служить предотвращение удаления данных, не имеющих ебилда в дереве портежей или в любом из подключенных оверлеев.</p>


	<p>o</p>


	<p style="padding-left:4em;">eclean также проинформирует вас об устаревших пакетах, установленных в вашей системе, как если бы она располагала данными о соответствующем им файле/файлах. Если вы хотите защитить от удаления все установленные источники исходного кода, сначала запустите eclean в режиме симуляции. Затем проверьте, для каких источников данных утилите не удалось найти файл/файлы и добавить соответствующие записи в файл distfiles.exclude. Только после этого можно снова вызвать eclean.</p>


	<p>По умолчанию, для действия "packages" (или "distfiles") будет использоваться путь /etc/eclean/packages.exclude, если он существует (или, соответственно, distfiles.exclude). Это поведение можно переопределить, используя опцию --exclude-file.</p>


	<h2 id="ПРИМЕРЫ">ПРИМЕРЫ<a href="#ПРИМЕРЫ" class="wiki-anchor">&para;</a></h2>


	<p>Удалить только исходные коды; по каждому удаляемому архиву будет выдан запрос на подтверждение удаления:</p>


	<pre><code><code># eclean -i distfiles</code></code></pre>


	<p>Проверить, какие бинарные пакеты можно удалить; вывод результатов - без цвета:</p>


	<pre><code><code># eclean -Cp packages</code></code></pre>


	<p>Удалить бинарные файлы удаленных пакетов, но сохранить все версии установленных:</p>


	<pre><code><code># eclean-pkg -d -n</code></code></pre>


	<p>Удалить все исходные коды, за исключением файлов установленных пакетов (точное соответствие версии), которые были созданы менее одного месяца назад, размером 50Mб или имеют ограничения по загрузке:</p>


	<pre><code><code># eclean-dist -d -t1m -s50M -f</code></code></pre>


	<p>По расписанию crontab каждое воскресенье в 1.00 автоматически удалять ненужные пакеты в наиболее безопасном режиме, а затем - исходные коды в режиме destructive, но не удалять файлы новее недели:</p>


	<pre><code><code>0 1 * * sun \ \ eclean -C -q packages ; eclean -C -q -d -t1w distfiles</code></code></pre>


	<h2 id="ПРИМЕЧАНИЕ">ПРИМЕЧАНИЕ<a href="#ПРИМЕЧАНИЕ" class="wiki-anchor">&para;</a></h2>


	<p>При запуске и поиске исходных кодов для удаления для удаления eclean будет выдавать сообщения обо всех устаревших пакетах, установленных в вашей системе. Соответствующие источники данных могут быть не защищены от удаления, если переменная SRC_URI не записана в базе данных установленного пакета. В последних версиях portage/pkgcore переменная SRC_URI не записывается.</p>


	<h2 id="ОШИБКИ">ОШИБКИ<a href="#ОШИБКИ" class="wiki-anchor">&para;</a></h2>


	<p>Решение о том, удалять или нет исходные коды, принимается на основе переменных SRC_URI ебилдов. Это означает, что, когда ебилд обращается к файлам, не указанным в его переменной SRC_URI, eclean, как правило, удаляет такие файлы. Это ошибка ебилда; сообщайте о таких ошибках на <noindex><a class="external" href="http://bugs.gentoo.org" ref="nofollow">http://bugs.gentoo.org</a></noindex>. 
В безопасном режиме (используется по умолчанию, с отключенной опцией --destructive) утилита может работать крайне медленно, и это можно поправить только в обход API портежей.</p>


	<h2 id="СМ-ТАКЖЕ">СМ. ТАКЖЕ<a href="#СМ-ТАКЖЕ" class="wiki-anchor">&para;</a></h2>


	<p>Тред форума Gentoo, с которого началась история eclean:</p>


	<p style="padding-left:4em;"><strong><noindex><a class="external" href="http://forums.gentoo.org/viewtopic.php?t=3011" ref="nofollow">http://forums.gentoo.org/viewtopic.php?t=3011</a></noindex></strong></p>


	<p>Заявка на багтрекере с просьбой включить eclean в gentoolkit:</p>


	<p style="padding-left:4em;"><strong><noindex><a class="external" href="http://bugs.gentoo.org/show_bug.cgi?id=33877" ref="nofollow">http://bugs.gentoo.org/show_bug.cgi?id=33877</a></noindex></strong></p>


	<h2 id="АВТОРЫ">АВТОРЫ<a href="#АВТОРЫ" class="wiki-anchor">&para;</a></h2>


	<ul>
	<li>Thomas de Grenier de Latour (tgl) &lt;<a class="email" href="mailto:degrenier@easyconnect.fr">degrenier@easyconnect.fr</a>&gt;<br />Модули были переписаны: </li>
		<li>Brian Dolbec (dol-sen) &lt;<a class="email" href="mailto:brian.dolbec@gmail.com">brian.dolbec@gmail.com</a>&gt;</li>
	</ul>


	<h2 id="ПЕРЕВОД">ПЕРЕВОД<a href="#ПЕРЕВОД" class="wiki-anchor">&para;</a></h2>


	<ul>
	<li>Елена Гаврилова &lt;<a class="email" href="mailto:e.vl.gavrilova@yandex.ru">e.vl.gavrilova@yandex.ru</a>&gt;</li>
	</ul>


	<p>&nbsp;<br />&nbsp;</p>


	<p>0.4.1</p>
</body>
</html>
