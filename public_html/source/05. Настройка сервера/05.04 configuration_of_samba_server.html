<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
<title>configuration of samba server</title>
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<style>
body { font:80% Verdana,Tahoma,Arial,sans-serif; }
h1, h2, h3, h4 {  font-family: "Trebuchet MS",Georgia,"Times New Roman",serif; }
ul.toc { padding: 4px; margin-left: 0; }
ul.toc li { list-style-type:none; }
ul.toc li.heading2 { margin-left: 1em; }
ul.toc li.heading3 { margin-left: 2em; }
a.wiki-anchor { display: none; margin-left: 6px; text-decoration: none; }
a.wiki-anchor:hover { color: #aaa !important; text-decoration: none; }
h1:hover a.wiki-anchor, h2:hover a.wiki-anchor, h3:hover a.wiki-anchor { display: inline; color: #ddd; }
pre {font-size:133% }
</style>
</head>
<body>
<h1 id="Настройка-Samba-сервера">Настройка Samba сервера<a href="#Настройка-Samba-сервера" class="wiki-anchor">&para;</a></h1>


	<h2 id="Введение">Введение<a href="#Введение" class="wiki-anchor">&para;</a></h2>


	<p><em>Samba</em> это популярный пакет программ с открытыми исходными текстами, которая предоставляет файловые и принт-сервисы Microsoft® Windows® клиентам. При помощи пакета утилит <a href="calculate-server.html" class="wiki-page new">calculate-server</a> на samba сервере создаются пользователи, группы, ресурсы и происходит управление ими. В качестве Linux клиента может  выступать <a href="Calculate Linux Desktop.html" class="wiki-page">Calculate Linux Desktop</a> или любой <em>Gentoo</em> дистрибутив с установленным пакетом <em>calculate-client</em>. В качестве Windows клиентов могут быть использованы операционные системы семейства Windows. Чтобы настроить сервер и клиент, воспользуйтесь статьей <a href="&quot;переход на использование Linux&quot;.html" class="wiki-page">"переход на использование Linux"</a>. Для указания настраиваемого пакета программ в <em>calculate-server</em> используется термин - сервис.</p>


	<p>Сервис <em>samba</em> используется для настройки <em>Samba</em>.</p>


	<p>Сервис обязательно указывается для программ пакета <em>calculate-server</em>.<br />Пример добавления пользователя <em>test</em>:<br /><pre>
cl-useradd test samba
</pre></p>


	<p>Для пользователя сервера права на файловые ресурсы одинаковы вне зависимости от клиента - Linux или Windows.</p>


	<p>Пакет Samba включен в поставку <a href="Calculate Directory Server.html" class="wiki-page">Calculate Directory Server</a>. Если вы используете другую Gentoo систему, пакет можно установить из портежей, выполнив <em>emerge net-fs/samba</em>.</p>


	<h2 id="Настройка-сервера">Настройка сервера<a href="#Настройка-сервера" class="wiki-anchor">&para;</a></h2>


	<p>Настройка сервера выполняется при помощи утилиты <em>calculate-server</em>. Для начала убедитесь что у вас <a href="настроен LDAP сервер.html" class="wiki-page">настроен LDAP сервер</a> и выполнены <a href="настройки Unix сервера.html" class="wiki-page">настройки Unix сервера</a>.</p>


	<p>Для настройки Samba-сервера выполните команду:<br /><pre>
cl-setup [параметры] samba
</pre></p>


В качестве параметров вы можете указать <em>netbios</em> и <em>workgroup</em>.
	<ul>
	<li>"-n name" - устанавливает имя NetBIOS, под которым будет работать Samba сервер. По умолчанию оно устанавливается равным первому компоненту DNS имени хоста.</li>
		<li>"-w workgroup" - имя домена или рабочей группы NT для компьютеров, которые будут получать доступ к этому серверу.</li>
	</ul>


	<p>Если Samba сервер будет выступать в качестве <em>PDC (первичного контроллера Windows домена)</em>, вам следует задать пароль администратора сервера - пользователя с логином <em>admin</em>.<br /><pre>
cl-passwd --smb admin  samba
</pre></p>


	<p>Пользователь admin используется только для ввода клиентского windows компьютера в домен. Он не имеет домашней директории.</p>


	<p>Если нужен администратор домена для управления windows компьютерами, добавьте нового пользователя  который будет включен в доменную группу "Domain Admins", или включите в эту группу существующего пользователя.</p>


	<p>Пример создания администратора домена:<br /><pre>
cl-useradd -p --gid "Domain Admins" -c "Администратор домена" d_admin samba
</pre></p>


	<p>Для <a href="подключения unix клиентов.html" class="wiki-page">подключения unix клиентов</a>, укажите пароль для служебного пользователя <em>client</em>.<br /><pre>
cl-passwd --smb client samba
</pre></p>


	<h2 id="Добавление-и-удаление-пользователей">Добавление и удаление пользователей<a href="#Добавление-и-удаление-пользователей" class="wiki-anchor">&para;</a></h2>


	<p>Для работы с пользователями, используйте аналоги стандартных Unix команд: <em>cl-useradd, cl-userdel, cl-usermod, cl-passwd, cl-groupadd, cl-groupdel, cl-groupmod</em>. Синтаксис этих команд будет во многом совпадать с оригинальными.</p>


	<p>Вместо <em>smbpasswd</em>, используйте <em>cl-passwd</em> для изменения паролей пользователей, в т.ч. администратора Windows компьютеров.</p>


	<p>Пример добавления пользователя test:<br /><pre>
cl-useradd test samba
</pre></p>


	<p>Пример изменения пароля пользователя test:<br /><pre>
cl-passwd test samba
</pre></p>


	<p>Пример добавления пользователя с первичной группой Domain Admins - администраторы домена<br /><pre>
cl-useradd -g 'Domain Admins' test samba
</pre></p>


	<p>Обратите внимание на опцию <em>samba</em>, добавляемую в конце команды.</p>


	<h2 id="Настройка-прав-доступа">Настройка прав доступа<a href="#Настройка-прав-доступа" class="wiki-anchor">&para;</a></h2>


	<h3 id="Настройка-прав-доступа-к-файловой-системе">Настройка прав доступа к файловой системе<a href="#Настройка-прав-доступа-к-файловой-системе" class="wiki-anchor">&para;</a></h3>


	<p>Для настройки прав доступа к файлам на сервере используйте ACL (Access Control List — список контроля доступа). Изменяя права на файлы, вы ограничиваете к ним доступ в равной степени как для Windows, так и для Linux клиентов.</p>


	<p>Права доступа применяются как к файлам, так и к директориям. Вы можете указать права доступа на владельца файла, либо на группу. Если Windows клиент будет распознавать только Samba группы, то в Linux будут отображаться имена Unix и Samba групп. Поэтому, для разграничения прав доступа, предпочтительней использовать Samba группы.</p>


	<p>Для создания Samba группы "manager", выполните:<br /><pre>
cl-groupadd manager samba
</pre></p>


	<p>для создания Unix группы "job", выполните:<br /><pre>
cl-groupadd job unix
</pre></p>


	<p>Подробно настройка прав доступа с использованием ACL описана в статье <a href="&quot;Настройка прав доступа файловой системы&quot;.html" class="wiki-page">"Настройка прав доступа файловой системы"</a>.</p>


	<h3 id="Настройка-прав-доступа-для-пользователей-Windows-компьютеров">Настройка прав доступа для пользователей Windows компьютеров<a href="#Настройка-прав-доступа-для-пользователей-Windows-компьютеров" class="wiki-anchor">&para;</a></h3>


	<p>Настройка прав доступа к общим файлам сервера описана выше.</p>


	<p>Для настройки дополнительных прав Windows машин, таких как: возможность устанавливать программы, возможность выхода из домена и т.д., используйте Samba группы.</p>


	<p>Пример повышения прав пользователя test до администратора домена:<br /><pre>
cl-groupmod -a test 'Domain Admins' samba
</pre></p>


	<h4>Структура Samba групп</h4>


Samba группы могут быть следующих типов:
	<ul>
	<li>Доменные группы (номер типа группы 2)</li>
		<li>Локальные группы (номер типа группы 4)</li>
		<li>Встроенные группы (номер типа группы 5)</li>
	</ul>


	<h5>Группы созданные по умолчанию</h5>


	<p><strong>Доменные группы</strong></p>


Доменные группы - глобальные группы которые действуют в домене.
	<ul>
	<li><em>Domain Admins</em> - администраторы домена (полные права на компьютерах в домене).</li>
		<li><em>Domain Guests</em> - гости домена (минимальные права).</li>
		<li><em>Domain Users</em> - пользователи домена.</li>
		<li><em>Domain Computers</em> - компьютеры домена.</li>
	</ul>


	<p><strong>Локальные группы</strong></p>


	<p>Локальные группы - группы действующие локально на данном компьютере.<br />Локальные группы отсутствуют.</p>


	<p><strong>Встроенные группы</strong></p>


	<p><em>Встроенные группы</em> - группы встроенные в систему.</p>


	<ul>
	<li><em>Administrators</em> - администраторы (полные права)</li>
		<li><em>Account Operators</em> - операторы учетных записей. Создание и управление пользовательской учетной информацией, создание и управление группами, резервное копирование файлов и каталогов.</li>
		<li><em>Backup Operators</em> - операторы архивов. Резервное копирование, восстановление из резервной копии, остановка системы. </li>
		<li><em>Print Operators</em> - операторы печати. Управление принтерами, резервное копирование.</li>
		<li><em>Replicators</em> - репликаторы. Эта группа используется службой репликации File Replication на контроллерах домена.</li>
		<li><em>System Operators</em> - операторы системы. Изменение системного времени, останов системы, останов с удаленной системы, резервное копирование, восстановление из резервной копии, блокирование сервера, преодоление блокировки сервера, форматирование жесткого диска, управление сетевыми каталогами, управление принтерами.</li>
	</ul>


	<h4>Создание Samba группы</h4>


	<p>Создание доменной группы test. По умолчанию создается доменная группа, тип группы - 2.<br /><pre>
cl-groupadd test samba
</pre></p>


	<p>Создание встроенной группы 'Power Users' - пользователи имеющие дополнительные права. <br /><pre>
cl-groupadd -g 547 --rid 547 -t 5 'Power Users' samba
</pre></p>


Где:
	<ul>
	<li><em>g</em> - идентификатор группы 547 (Group ID)</li>
		<li><em>rid</em> - уникальный идентификатор 547 (RID)</li>
		<li><em>t</em> - тип группы 5 (встроенная группа)</li>
	</ul>


	<h2 id="Просмотр-информации">Просмотр информации<a href="#Просмотр-информации" class="wiki-anchor">&para;</a></h2>


	<p>Для просмотра информации о пользователях и группах сервера воспользуемся командой <em>cl-info</em>:</p>


	<p>Перечень пользователей unix cервиса:<br /><pre>
cl-info -u unix
</pre></p>


	<p>Перечень пользователей samba сервиса:<br /><pre>
cl-info -u samba
</pre></p>


	<p>Просмотр информации о пользователе unix сервиса:<br /><pre>
cl-info -U &lt;название пользователя&gt; unix
</pre></p>


	<p>Просмотр информации о пользователе samba сервиса:<br /><pre>
cl-info -U &lt;название пользователя&gt; samba
</pre></p>


	<p>Перечень существующих групп unix сервиса:<br /><pre>
cl-info -g unix
</pre></p>


	<p>Перечень существующих групп samba сервиса:<br /><pre>
cl-info -g samba
</pre></p>


	<p>Просмотр информации о группе unix сервиса:<br /><pre>
cl-info -G &lt;название группы&gt; unix
</pre></p>


	<p>Просмотр информации о группе samba сервиса:<br /><pre>
cl-info -G &lt;название группы&gt; samba
</pre></p>
</body>
</html>
